<html>
<head>

<style>
p {
    color : black; font-family:courier; font-size: 80%;
}
body {
    line-height: 120%; font-family:courier; font-zize:60%;
}
.tlc_func {color : blue; font-weight: bold; font-size:120%;}
.tlc_comment {color : #9aa;}
.tlc_if {color: green;}.tlc_assign {color: green;}.tlc_each {color: green;}.tlc_foreach {color: green;}.tlc_endif {color: green;}.tlc_switch {color: green;}.tlc_case {color: green;}.tlc_return {color: green;}.tlc_elseif {color: green;}.tlc_else {color: green;}.tlc_assert {color: green;}.tlc_endwith {color: green;}.tlc_endforeach {color: green;}.tlc_generatefile {color: green;}.tlc_includepath {color: green;}.tlc_include {color: green;}.tlc_sprintf {color: green;}.tlc_while {color: green;}.tlc_endwhile {color: green;}.tlc_default {color: green;}.tlc_createrecord {color: green;}.tlc_mergerecord {color: green;}.tlc_language {color: green;}.tlc_roll {color: green;}.tlc_endroll {color: green;}.tlc_with {color: green;}.tlc_selectfile {color: green;}.tlc_openfile {color: green;}.tlc_closefile {color: green;}.tlc_def {color: green;}.tlc_undef {color: green;}.tlc_realformat {color: green;}.tlc_endswitch {color: green;}.tlc_addtorecord {color: green;}.tlc_break {color: green;}
.tlc_bifunc {color: brown;}
.tlc_fkw {color:blue; font-weight: 800;}
.tlc_output {color:#FFF; font-style:italic;}
.tlc_mchar {color:purple;}
</style>

</head>
<body>
<span class="tlc_comment">%%<span style="padding-left:9.5px"></span>
</span> <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span>
</span> <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span>
</span> <br><span class="tlc_comment">%%
</span> <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span>Copyright<span style="padding-left:9.5px"></span>1994-2013<span style="padding-left:9.5px"></span>The<span style="padding-left:9.5px"></span>MathWorks,<span style="padding-left:9.5px"></span>Inc.
</span> <br><span class="tlc_comment">%%
</span> <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span>Abstract:<span style="padding-left:9.5px"></span>Variable<span style="padding-left:9.5px"></span>Transport<span style="padding-left:9.5px"></span>Delay<span style="padding-left:9.5px"></span>block<span style="padding-left:9.5px"></span>target<span style="padding-left:9.5px"></span>file
</span> <br>&nbsp; <br><span class="tlc_implements">%implements</span> VariableTransportDelay "C"
 <br>&nbsp; <br><span class="tlc_include">%include</span> "<a href="https://foool.github.io/r2020a/rtw/c/tlc/blocks/tdelay_sup.html">tdelay_sup.tlc</a>"
 <br>&nbsp; <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span>Function:<span style="padding-left:9.5px"></span>FcnVTDelayTypeSetup<span style="padding-left:9.5px"></span>===============================================
</span> <br><span class="tlc_fkw">%function</span> <a id="BlockTypeSetup" class="tlc_func">BlockTypeSetup</a>(block, system) <span class="tlc_fkw">void</span>
 <br>&nbsp;&nbsp;%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/blocks/tdelay_sup.html#TDelayTypeSetup">TDelayTypeSetup</a>(block, system)>
 <br><span class="tlc_fkw">%endfunction</span>
 <br>&nbsp; <br>&nbsp; <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span>Function:<span style="padding-left:9.5px"></span>FcnVTDelayStart<span style="padding-left:9.5px"></span>===================================================
</span> <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span>Abstract:
</span> <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span>Start<span style="padding-left:9.5px"></span>code<span style="padding-left:9.5px"></span>for<span style="padding-left:9.5px"></span>the<span style="padding-left:9.5px"></span>Variable<span style="padding-left:9.5px"></span>Transport<span style="padding-left:9.5px"></span>delay<span style="padding-left:9.5px"></span>blocks.
</span> <br><span class="tlc_comment">%%
</span> <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span>o)<span style="padding-left:9.5px"></span>Initialize<span style="padding-left:9.5px"></span>the<span style="padding-left:9.5px"></span>work<span style="padding-left:9.5px"></span>vectors
</span> <br><span class="tlc_comment">%%
</span> <br><span class="tlc_fkw">%function</span> <a id="Start" class="tlc_func">Start</a>(block, system) <span class="tlc_fkw">Output</span>
 <br>&nbsp;&nbsp;<span class="tlc_assign">%assign</span> isRSIM = isRSim
 <br>&nbsp;&nbsp;{
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% If is delay type is variable transport delay, buffer will be larger to </span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% store the state </span>
 <br>&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> (ParamSettings.Transportdelay == "yes" ) 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> isTransportdelay = TLC_TRUE
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> numBuffer =3 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_else">%else</span> 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> isTransportdelay = TLC_FALSE
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> numBuffer =2
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> blockWidth = <a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/blkiolib.html#LibBlockOutputSignalWidth">LibBlockOutputSignalWidth</a>(0)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%%</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% Initialize</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%%</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% For RSIM, we need to allocate the pBuffer for </span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% each element in the output port separately. This</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% is because if we need to grow the buffer, then we</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% we will free the memory associated with the buffer</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% so there can't be a single buffer for the block.</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> !isRSIM
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;real_T *pBuffer = &amp;%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/blocklib.html#LibBlockRWork">LibBlockRWork</a>(TUbufferArea, "", "", 0)>;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;int_T j; 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% Do not change this value without updating the</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% code below for allocating pbuffer</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> localRollThreshold = 2
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%%</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% Declare a local constant buffer size array and/or initial output</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% array if needed (when rolling)</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%%</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> useConstBufSzVect  = 0
 <br>&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> WILL_ROLL(RollRegions, localRollThreshold)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%%</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% Buffer size array for roller</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%%</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> <span class="tlc_bifunc">SIZE</span>(ParamSettings.BufferSize,1) > 1
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/utillib.html#LibGenConstVectWithInit">LibGenConstVectWithInit</a>(ParamSettings.BufferSize,tSS_INT32,"bufSz")>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> useConstBufSzVect = 1
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> rollVars = ["<iwork>/Tail","<iwork>/Head",...
 <br>&nbsp;&nbsp;&nbsp;&nbsp;"<iwork>/Last","<iwork>/CircularBufSize",...
 <br>&nbsp;&nbsp;&nbsp;&nbsp;"<pwork>/TUbufferPtrs", "<param>/InitialOutput"]
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_roll">%roll</span> idx = RollRegions, lcv = localRollThreshold, block, "Roller", rollVars
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%%</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% Compute buffer size</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%%</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> lcv == ""
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> paramSettingIdx = idx
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_else">%else</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> idx == 0
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> paramSettingIdx = lcv
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_else">%else</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> paramSettingIdx = "%<<span>lcv</span>> + %<<span>idx</span>>"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> useConstBufSzVect
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> bufSz = "bufSz[%<<span>paramSettingIdx</span>>]"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_else">%else</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> bufSz = (<span class="tlc_bifunc">SIZE</span>(ParamSettings.BufferSize,1) == 1? ...
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ParamSettings.BufferSize[0]: ...
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ParamSettings.BufferSize[paramSettingIdx])
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%%</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% Initialize the iwork and pointer work vectors</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%%</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> tail = <a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/blocklib.html#LibBlockIWork">LibBlockIWork</a>(Tail,"",lcv,idx)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> head = <a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/blocklib.html#LibBlockIWork">LibBlockIWork</a>(Head,"",lcv,idx)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> last = <a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/blocklib.html#LibBlockIWork">LibBlockIWork</a>(Last,"",lcv,idx)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> bufferSiz = <a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/blocklib.html#LibBlockIWork">LibBlockIWork</a>(CircularBufSize,"",lcv,idx)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> initOutput= <a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/paramlib.html#LibBlockParameter">LibBlockParameter</a>(InitialOutput, "",lcv,idx)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> isRSIM
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% We need an extra {} if we aren't rolling to make</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% sure that we avoid symbol clashing for pbuffer</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> lcv == ""
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% This is called instead of utMalloc() in order to avoid Windows-specific </span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% crash due to mallocing and freeing in different libs.</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> utilName = <a href="https://foool.github.io/r2020a/rtw/c/tlc/blocks/tdelay_sup.html#TDelay_CreateBuf">TDelay_CreateBuf</a>(block)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;real_T *pBuffer = (real_T *)%<<span>utilName</span>>(%<<span>numBuffer</span>>, %<<span>bufSz</span>>, sizeof(real_T));
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (pBuffer == %<<span><a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/utillib.html#SLibGetNullDefinitionFromTfl">SLibGetNullDefinitionFromTfl</a>()</span>>) {
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/rtmdllib_obs.html#RTMSetErrStat">RTMSetErrStat</a>("/"vtdelay memory allocation error/"")>;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<span>tail</span>> = 0;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<span>head</span>> = 0;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<span>last</span>> = 0;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<span>bufferSiz</span>> = %<<span>bufSz</span>>;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%%    </span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(j=0; j < %<<span>bufSz</span>>; j++){
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pBuffer[j]        = %<<span>initOutput</span>>;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pBuffer[%<<span>bufSz</span>> + j] = %<<span><a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/utillib.html#LibGetT">LibGetT</a>()</span>>;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%%</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> lcv != ""
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> pUbuf = <a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/blocklib.html#LibBlockPWork">LibBlockPWork</a>(TUbufferPtrs, "", lcv, idx)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> pTbuf = <a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/blocklib.html#LibBlockPWork">LibBlockPWork</a>(TUbufferPtrs, "", ...
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"%<<span>lcv</span>>+%<<span>blockWidth</span>>", idx)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> isTransportdelay
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> pXbuf = <a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/blocklib.html#LibBlockPWork">LibBlockPWork</a>(TUbufferPtrs, "", ...
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"%<<span>lcv</span>>+%<2*blockWidth>", idx)        
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pBuffer[2*%<<span>bufSz</span>>] = 0.0;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span> 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_else">%else</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> pUbuf = <a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/blocklib.html#LibBlockPWork">LibBlockPWork</a>(TUbufferPtrs, "", lcv, idx)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> pTbuf = <a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/blocklib.html#LibBlockPWork">LibBlockPWork</a>(TUbufferPtrs, "", lcv, idx+blockWidth)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> isTransportdelay
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> pXbuf = <a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/blocklib.html#LibBlockPWork">LibBlockPWork</a>(TUbufferPtrs, "", lcv, idx+2*blockWidth)      
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pBuffer[2*%<<span>bufSz</span>>] = 0.0;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span> 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%%</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<span>pUbuf</span>> = (void *) &amp;pBuffer[0];
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<span>pTbuf</span>> = (void *) &amp;pBuffer[%<<span>bufSz</span>>];
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> isTransportdelay
 <br>&nbsp;&nbsp;&nbsp;&nbsp;%<<span>pXbuf</span>> = (void *) &amp;pBuffer[2*%<<span>bufSz</span>>];      
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span> 
 <br>&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% Never do this for RSIM because we allocate separate pbuffers</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% for each output element.</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> !isRSIM &amp;&amp; ((lcv != "") || (lcv == "" &amp;&amp; idx < blockWidth-1))
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> <span class="tlc_bifunc">TYPE</span>(bufSz) == "Number"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pBuffer += %<numBuffer*bufSz>;      
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_else">%else</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pBuffer += %<<span>numBuffer</span>>*%<<span>bufSz</span>>;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> isRSIM &amp;&amp; lcv == ""
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endroll">%endroll</span>
 <br>&nbsp;&nbsp;}
 <br>&nbsp; <br><span class="tlc_fkw">%endfunction</span> <span class="tlc_comment">%%End FcnVTDelayStart</span>
 <br>&nbsp; <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span>Function:<span style="padding-left:9.5px"></span>FcnVTInitializeCondition<span style="padding-left:9.5px"></span>=========================================
</span> <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span>Abstract:
</span> <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span>For<span style="padding-left:9.5px"></span>the<span style="padding-left:9.5px"></span>variable<span style="padding-left:9.5px"></span>transport<span style="padding-left:9.5px"></span>delay<span style="padding-left:9.5px"></span>block,<span style="padding-left:9.5px"></span>initialzie<span style="padding-left:9.5px"></span>the<span style="padding-left:9.5px"></span>states
</span> <br><span class="tlc_fkw">%function</span> <a id="InitializeConditions" class="tlc_func">InitializeConditions</a>(block, system) <span class="tlc_fkw">Output</span>
 <br>&nbsp;&nbsp;<span class="tlc_if">%if</span> (ParamSettings.Transportdelay == "yes" )       
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> ncStates = ContStates[0]
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> rollRegions = [0:%<ncStates-1>]
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> rollVars = ["Xc"]
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_roll">%roll</span> sigIdx = rollRegions, lcv = RollThreshold, block, "Roller", rollVars
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/blocklib.html#LibBlockContinuousState">LibBlockContinuousState</a>("", lcv, sigIdx)> = 0.0;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endroll">%endroll</span>
 <br>&nbsp;&nbsp;<span class="tlc_else">%else</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% For variable time delay, no state, do nothing  </span>
 <br>&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br><span class="tlc_fkw">%endfunction</span> <span class="tlc_comment">%% InitializeConditions</span>
 <br>&nbsp; <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span>Function:<span style="padding-left:9.5px"></span>FcnIsReal<span style="padding-left:9.5px"></span>=========================================================
</span> <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span>Abstract:
</span> <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span>Given<span style="padding-left:9.5px"></span>a<span style="padding-left:9.5px"></span>string,<span style="padding-left:9.5px"></span>does<span style="padding-left:9.5px"></span>evaluation<span style="padding-left:9.5px"></span>of<span style="padding-left:9.5px"></span>this<span style="padding-left:9.5px"></span>string<span style="padding-left:9.5px"></span>result<span style="padding-left:9.5px"></span>in<span style="padding-left:9.5px"></span>a<span style="padding-left:9.5px"></span>number.
</span> <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span>For<span style="padding-left:9.5px"></span>example<span style="padding-left:9.5px"></span>if<span style="padding-left:9.5px"></span>str<span style="padding-left:9.5px"></span>=<span style="padding-left:9.5px"></span>"1.0",<span style="padding-left:9.5px"></span>then<span style="padding-left:9.5px"></span>%<<span>str</span>><span style="padding-left:9.5px"></span>==<span style="padding-left:9.5px"></span>1.0
</span> <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span>If<span style="padding-left:9.5px"></span>str<span style="padding-left:9.5px"></span>=<span style="padding-left:9.5px"></span>"a2",<span style="padding-left:9.5px"></span>then<span style="padding-left:9.5px"></span>%<<span>str</span>><span style="padding-left:9.5px"></span>would<span style="padding-left:9.5px"></span>be<span style="padding-left:9.5px"></span>an<span style="padding-left:9.5px"></span>error.
</span> <br><span class="tlc_comment">%%
</span> <br>&nbsp; <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span>This<span style="padding-left:9.5px"></span>function<span style="padding-left:9.5px"></span>is<span style="padding-left:9.5px"></span>needed<span style="padding-left:9.5px"></span>because<span style="padding-left:9.5px"></span>LibBlockParameter<span style="padding-left:9.5px"></span>always<span style="padding-left:9.5px"></span>returns<span style="padding-left:9.5px"></span>a<span style="padding-left:9.5px"></span>string,
</span> <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span>we<span style="padding-left:9.5px"></span>need<span style="padding-left:9.5px"></span>to<span style="padding-left:9.5px"></span>find<span style="padding-left:9.5px"></span>out<span style="padding-left:9.5px"></span>if<span style="padding-left:9.5px"></span>this<span style="padding-left:9.5px"></span>string<span style="padding-left:9.5px"></span>is<span style="padding-left:9.5px"></span>a<span style="padding-left:9.5px"></span>number.<span style="padding-left:9.5px"></span>To<span style="padding-left:9.5px"></span>do<span style="padding-left:9.5px"></span>this<span style="padding-left:9.5px"></span>we<span style="padding-left:9.5px"></span>use<span style="padding-left:9.5px"></span>FEVAL
</span> <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span>to<span style="padding-left:9.5px"></span>call<span style="padding-left:9.5px"></span>a<span style="padding-left:9.5px"></span>matlab<span style="padding-left:9.5px"></span>function<span style="padding-left:9.5px"></span>that<span style="padding-left:9.5px"></span>parses<span style="padding-left:9.5px"></span>the<span style="padding-left:9.5px"></span>resultant<span style="padding-left:9.5px"></span>type.
</span> <br><span class="tlc_comment">%%
</span> <br>&nbsp; <br><span class="tlc_fkw">%function</span> <a id="FcnIsReal" class="tlc_func">FcnIsReal</a>(strValue)
 <br>&nbsp; <br>&nbsp;&nbsp;<span class="tlc_assign">%assign</span> temp = <span class="tlc_bifunc">FEVAL</span>("sscanf",strValue,"%f%1s")
 <br>&nbsp;&nbsp;<span class="tlc_return">%return</span> <span class="tlc_bifunc">SIZE</span>(temp,0) == 1
 <br>&nbsp; <br><span class="tlc_fkw">%endfunction</span> <span class="tlc_comment">%%End FcnIsReal</span>
 <br>&nbsp; <br>&nbsp; <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span>Function:<span style="padding-left:9.5px"></span>FcnVTDelayOutputs<span style="padding-left:9.5px"></span>==================================================
</span> <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span>Abstract:
</span> <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span>Using<span style="padding-left:9.5px"></span>the<span style="padding-left:9.5px"></span>transport<span style="padding-left:9.5px"></span>delay<span style="padding-left:9.5px"></span>'state'<span style="padding-left:9.5px"></span>information,<span style="padding-left:9.5px"></span>delay<span style="padding-left:9.5px"></span>the<span style="padding-left:9.5px"></span>input<span style="padding-left:9.5px"></span>by<span style="padding-left:9.5px"></span>the<span style="padding-left:9.5px"></span>
</span> <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span>specified<span style="padding-left:9.5px"></span>amount<span style="padding-left:9.5px"></span>of<span style="padding-left:9.5px"></span>time,<span style="padding-left:9.5px"></span>simulating<span style="padding-left:9.5px"></span>a<span style="padding-left:9.5px"></span>time<span style="padding-left:9.5px"></span>delay.<span style="padding-left:9.5px"></span>
</span> <br><span class="tlc_comment">%%
</span> <br><span class="tlc_fkw">%function</span> <a id="Outputs" class="tlc_func">Outputs</a>(block, system) <span class="tlc_fkw">Output</span>
 <br>&nbsp;&nbsp;{
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> (ParamSettings.Transportdelay == "yes" ) 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> isTransportdelay = TLC_TRUE
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_else">%else</span> 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> isTransportdelay = TLC_FALSE
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> blockWidth = <a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/blkiolib.html#LibBlockOutputSignalWidth">LibBlockOutputSignalWidth</a>(0)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> inport0Width = <a href="https://foool.github.io/r2020a/rtw/c/tlc/public_api/blkio_api.html#LibBlockInputSignalWidth">LibBlockInputSignalWidth</a>(0)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%%</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% If needed, setup static const vectors to capture:</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%%   - what input port 0 signals are discrete</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%%   - what the buffer sizes are</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% This is done, only if the block will 'roll' and these vectors are</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% of length greater than 1.</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%%</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> useConstIsDiscVect = 0
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> localRollThreshold = 2  
 <br>&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> WILL_ROLL(RollRegions, localRollThreshold)
 <br>&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> <span class="tlc_bifunc">SIZE</span>(ParamSettings.DiscreteInput,1) > 1
 <br>&nbsp;&nbsp;&nbsp;&nbsp;%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/utillib.html#LibGenConstVectWithInit">LibGenConstVectWithInit</a>(ParamSettings.DiscreteInput,...
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tSS_BOOLEAN,"isDiscrete")>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> useConstIsDiscVect = 1
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%%</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% Declare local variables</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%%</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;real_T **uBuffer = (real_T**)&amp;%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/blocklib.html#LibBlockPWork">LibBlockPWork</a>(TUbufferPtrs,"","",0)>;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;real_T **tBuffer = (real_T**)&amp;%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/blocklib.html#LibBlockPWork">LibBlockPWork</a>(TUbufferPtrs,"","",...
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;blockWidth)>;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> isTransportdelay
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;real_T **xBuffer = (real_T**)&amp;%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/blocklib.html#LibBlockPWork">LibBlockPWork</a>(TUbufferPtrs,"","",...
 <br>&nbsp;&nbsp;&nbsp;&nbsp;2*blockWidth)>;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> ::CompiledModel.StartTime != 0.0
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> tStart = <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/rtmdllib_obs.html#RTMGet">RTMGet</a>("TStart")
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_else">%else</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> tStart = 0.0
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;real_T simTime   = %<<span><a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/utillib.html#LibGetT">LibGetT</a>()</span>>;     
 <br>&nbsp;&nbsp;&nbsp;&nbsp;real_T appliedDelay;  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%%</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% Produce the output (roll it!)</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%%</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> isTransportdelay
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% Non-directfeedthrough, don't need input variables</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> rollVars = ["Xc","y0",...
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<param>/InitialOutput ","<iwork>/Tail","<iwork>/Head",...
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<iwork>/Last","<iwork>/CircularBufSize"]
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_else">%else</span> 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% for variable time delay and zerohandle is checked, u0 is needed</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> (ParamSettings.HandleZeroDelay == "yes") 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> rollVars = ["u0", "u1","y0","<param>/MaximumDelay",...
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<param>/InitialOutput ", "<iwork>/Tail","<iwork>/Head",...
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<iwork>/Last","<iwork>/CircularBufSize"]
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_else">%else</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> rollVars = ["u1","y0","<param>/MaximumDelay",...
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<param>/InitialOutput ", "<iwork>/Tail","<iwork>/Head",...
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<iwork>/Last","<iwork>/CircularBufSize"]
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span> 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_roll">%roll</span> idx = RollRegions, lcv = localRollThreshold, block, "Roller", rollVars
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> tail = <a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/blocklib.html#LibBlockIWork">LibBlockIWork</a>(Tail, "", lcv, idx)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> head = <a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/blocklib.html#LibBlockIWork">LibBlockIWork</a>(Head, "", lcv, idx)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> last = <a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/blocklib.html#LibBlockIWork">LibBlockIWork</a>(Last, "", lcv, idx)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> initOutput = <a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/paramlib.html#LibBlockParameter">LibBlockParameter</a>(InitialOutput, "",lcv,idx) 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> y = <a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/blkiolib.html#LibBlockOutputSignal">LibBlockOutputSignal</a>(0, "", lcv, idx)        
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> lcv == ""
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> paramSettingIdx = idx
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_else">%else</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> idx == 0
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> paramSettingIdx = lcv
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_else">%else</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> paramSettingIdx = "%<<span>lcv</span>> + %<<span>idx</span>>"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> useConstIsDiscVect
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> isDiscrete = "isDiscrete[%<<span>paramSettingIdx</span>>]"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_else">%else</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> isDiscrete = (<span class="tlc_bifunc">SIZE</span>(ParamSettings.DiscreteInput,1) == 1? ...
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ParamSettings.DiscreteInput[0]: ...
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ParamSettings.DiscreteInput[paramSettingIdx])
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> bufSz = <a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/blocklib.html#LibBlockIWork">LibBlockIWork</a>(CircularBufSize, "", lcv, idx)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> ( Accelerator || isRSim || ...
 <br>&nbsp;&nbsp;&nbsp;&nbsp;CodeFormat == "S-Function" || ...
 <br>&nbsp;&nbsp;&nbsp;&nbsp;SolverType == "VariableStep" || ...
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/modelrefutil.html#IsModelReferenceForASimstructBasedTarget">IsModelReferenceForASimstructBasedTarget</a>() )
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> minorStepAndTAtLastMajorOutput = ...
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"(boolean_T) " ...
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"(%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/rtmdllib_obs.html#RTMIs">RTMIs</a>("MinorTimeStep")> &amp;&amp; " ...
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"(%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/rtmdllib_obs.html#RTMGet">RTMGet</a>("TimeOfLastOutput")> == %<<span><a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/utillib.html#LibGetT">LibGetT</a>()</span>>))"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_else">%else</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> minorStepAndTAtLastMajorOutput = 0
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% The cast to boolean_T above is to avoid MSVC warning C4761:</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% "integral size mismatch in argument; conversion supplied"</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> isTransportdelay                    
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% First call unitility to generate rt_VTDelayfindtDInterpolate        </span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> utilName = <a href="https://foool.github.io/r2020a/rtw/c/tlc/blocks/tdelay_sup.html#VTDelay_FindtDInterpolate">VTDelay_FindtDInterpolate</a>(block)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% Then call it </span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> x = <a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/blocklib.html#LibBlockContinuousState">LibBlockContinuousState</a>("",lcv, idx)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* For variable transport dealy, find the real applied dealy 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* here and then output
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/     
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<span>y</span>>= %<<span>utilName</span>>(%<<span>x</span>>,*tBuffer,*uBuffer, *xBuffer,
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<span>bufSz</span>>,%<<span>head</span>>,%<<span>tail</span>>, &amp;%<<span>last</span>>, simTime, %<<span>tStart</span>>,%<<span>isDiscrete</span>>,
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<span>minorStepAndTAtLastMajorOutput</span>>, %<<span>initOutput</span>>,
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;appliedDelay);                 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_else">%else</span>     
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> maxDelay = <a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/paramlib.html#LibBlockParameter">LibBlockParameter</a>(MaximumDelay, "", lcv, idx)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;appliedDelay  = %<<a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/blkiolib.html#LibBlockInputSignal">LibBlockInputSignal</a>(1, "", lcv, idx)>;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* For variable time delay, output here */
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( appliedDelay > %<<span>maxDelay</span>>) {
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;appliedDelay = %<<span>maxDelay</span>>;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}      
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( appliedDelay < 0.0) {
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* negative delay is not supported
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*  set delay to 0
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;appliedDelay = 0.0;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> tMinusDelay = "simTime - appliedDelay"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% First call unitility to generate rt_TDelayInterpolate</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> utilName = <a href="https://foool.github.io/r2020a/rtw/c/tlc/blocks/tdelay_sup.html#TDelay_Interpolate">TDelay_Interpolate</a>(block)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% Then call it. </span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> (ParamSettings.HandleZeroDelay == "yes") 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(appliedDelay == 0.0){  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> u0 = <a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/blkiolib.html#LibBlockInputSignal">LibBlockInputSignal</a>(0, "", lcv, idx)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<span>y</span>> = %<<span>u0</span>>;           
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else{
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<span>y</span>> = %<<span>utilName</span>>(
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<span>tMinusDelay</span>>,
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<span>tStart</span>>,
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*tBuffer,
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*uBuffer,
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<span>bufSz</span>>,
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;%<<span>last</span>>,
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<span>tail</span>>,
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<span>head</span>>,
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<span>initOutput</span>>,
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<span>isDiscrete</span>>,
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<span>minorStepAndTAtLastMajorOutput</span>>);                            
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_else">%else</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<span>y</span>> = %<<span>utilName</span>>(
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<span>tMinusDelay</span>>,
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<span>tStart</span>>,
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*tBuffer,
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*uBuffer,
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<span>bufSz</span>>,
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;%<<span>last</span>>,
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<span>tail</span>>,
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<span>head</span>>,
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<span>initOutput</span>>,
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<span>isDiscrete</span>>,
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<span>minorStepAndTAtLastMajorOutput</span>>);                                   
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>      
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> (lcv != "") || (lcv == "" &amp;&amp; idx < blockWidth-1)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;tBuffer++; uBuffer++;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> isTransportdelay
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xBuffer++;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endroll">%endroll</span>
 <br>&nbsp;&nbsp;}
 <br><span class="tlc_fkw">%endfunction</span> <span class="tlc_comment">%%End FcnVTDelayOutputs</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp; <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span>Function:<span style="padding-left:9.5px"></span>FcnVTDelayUpdate<span style="padding-left:9.5px"></span>===================================================
</span> <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span>Abstract:
</span> <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span>Update<span style="padding-left:9.5px"></span>the<span style="padding-left:9.5px"></span>state<span style="padding-left:9.5px"></span>information<span style="padding-left:9.5px"></span>of<span style="padding-left:9.5px"></span>the<span style="padding-left:9.5px"></span>variable<span style="padding-left:9.5px"></span>transport<span style="padding-left:9.5px"></span>delay.
</span> <br><span class="tlc_comment">%%
</span> <br><span class="tlc_fkw">%function</span> <a id="Update" class="tlc_func">Update</a>(block, system) <span class="tlc_fkw">Output</span>
 <br>&nbsp;&nbsp;{
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> (ParamSettings.Transportdelay == "yes" ) 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> isTransportdelay = TLC_TRUE
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_else">%else</span> 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> isTransportdelay = TLC_FALSE
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> blockWidth = <a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/blkiolib.html#LibBlockOutputSignalWidth">LibBlockOutputSignalWidth</a>(0)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> inport0Width = <a href="https://foool.github.io/r2020a/rtw/c/tlc/public_api/blkio_api.html#LibBlockInputSignalWidth">LibBlockInputSignalWidth</a>(0)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;real_T **uBuffer = (real_T**)&amp;%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/blocklib.html#LibBlockPWork">LibBlockPWork</a>(TUbufferPtrs,"","",0)>;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;real_T **tBuffer = (real_T**)&amp;%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/blocklib.html#LibBlockPWork">LibBlockPWork</a>(TUbufferPtrs,"","",...
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;blockWidth)>;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> isTransportdelay
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;real_T **xBuffer = (real_T**)&amp;%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/blocklib.html#LibBlockPWork">LibBlockPWork</a>(TUbufferPtrs,"","",...
 <br>&nbsp;&nbsp;&nbsp;&nbsp;2*blockWidth)>;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_elseif">%elseif</span> isRSim || Accelerator
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;real_T **xBuffer = %<<span><a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/utillib.html#SLibGetNullDefinitionFromTfl">SLibGetNullDefinitionFromTfl</a>()</span>>;    
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;real_T simTime   = %<<span><a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/utillib.html#LibGetT">LibGetT</a>()</span>>;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> (ParamSettings.FixedBuffer == "yes" ) 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> isFixedbuf = TLC_TRUE  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;boolean_T bufferisfull = %<GET_TYPE_ID_REPLACEMENT("false")>; 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_else">%else</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> isFixedbuf = TLC_FALSE
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/utillib.html#LibUpdateBlockCStateAbsoluteTolerance">LibUpdateBlockCStateAbsoluteTolerance</a>(block, system)>  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> delayPrm = "MaximumDelay"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% u1 is needed</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> rollVars = ["u0", "u1", "<iwork>/Tail","<iwork>/Head", ...
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<iwork>/CircularBufSize", "<param>/%<<span>delayPrm</span>>"]
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> isTransportdelay
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> rollVars = ["Xc","u0","u1", "<iwork>/Tail","<iwork>/Head", ...
 <br>&nbsp;&nbsp;&nbsp;&nbsp;"<iwork>/CircularBufSize"]
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> Accelerator || isRSim
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> rollVars = ["u0", "u1", "<iwork>/Tail","<iwork>/Head", ...
 <br>&nbsp;&nbsp;&nbsp;&nbsp;"<iwork>/Last", "<iwork>/CircularBufSize", "<param>/%<<span>delayPrm</span>>"]
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> maxNewBufSz = <a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/blocklib.html#LibBlockIWork">LibBlockIWork</a>(MaxNewBufSize, "", "", 0)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> isTransportdelay
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> rollVars = ["Xc","u0", "u1", "<iwork>/Tail","<iwork>/Head", ...
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"<iwork>/Last", "<iwork>/CircularBufSize", "<param>/%<<span>delayPrm</span>>"]
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_roll">%roll</span> idx = RollRegions, lcv = RollThreshold, block, "Roller", rollVars
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> tail  = <a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/blocklib.html#LibBlockIWork">LibBlockIWork</a>(Tail, "", lcv, idx)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> head  = <a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/blocklib.html#LibBlockIWork">LibBlockIWork</a>(Head, "", lcv, idx)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> bufSz = <a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/blocklib.html#LibBlockIWork">LibBlockIWork</a>(CircularBufSize, "", lcv, idx)    
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<span>head</span>> = ((%<<span>head</span>> < (%<<span>bufSz</span>>-1)) ? (%<<span>head</span>>+1) : 0);
 <br>&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (%<<span>head</span>> == %<<span>tail</span>>) {
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> isFixedbuf
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bufferisfull = %<GET_TYPE_ID_REPLACEMENT("true")>;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> Accelerator || isRSim
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> last        = <a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/blocklib.html#LibBlockIWork">LibBlockIWork</a>(Last, "", lcv, idx)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> tDelay      = <a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/paramlib.html#LibBlockParameter">LibBlockParameter</a>(%<<span>delayPrm</span>>, "", lcv, idx)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> tMinusDelay = "simTime - %<<span>tDelay</span>>"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% first call unitility to generate rt_TDelayUpdateTailOrGrowBuf</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> utilName = <a href="https://foool.github.io/r2020a/rtw/c/tlc/blocks/tdelay_sup.html#TDelay_UpdateTailOrGrowBuf">TDelay_UpdateTailOrGrowBuf</a>(block)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% Then call this function</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!%<<span>utilName</span>>( &amp;%<<span>bufSz</span>>, ...
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;%<<span>tail</span>>, &amp;%<<span>head</span>>, &amp;%<<span>last</span>>, %<<span>tMinusDelay</span>>, ...
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tBuffer, uBuffer, xBuffer,(boolean_T)%<<span>isFixedbuf</span>>, ...
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(boolean_T)%<<span>isTransportdelay</span>>, 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;%<<span>maxNewBufSz</span>>) ) {
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/rtmdllib_obs.html#RTMSetErrStat">RTMSetErrStat</a>("/"vtdelay memory allocation error/"")>;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_else">%else</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% Handle buffer overflows by loosing oldest data.</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<span>tail</span>> = ((%<<span>tail</span>> < (%<<span>bufSz</span>>-1)) ? (%<<span>tail</span>>+1) : 0);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> (lcv != "") || (lcv == "" &amp;&amp; idx < blockWidth-1)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> pp = "++"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_else">%else</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> pp = ""
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(*tBuffer%<<span>pp</span>>)[%<<span>head</span>>] = simTime;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> (inport0Width == 1)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% Input is scalar, no need to roll here, see g1408910</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(*uBuffer%<<span>pp</span>>)[%<<span>head</span>>] = %<<a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/blkiolib.html#LibBlockInputSignal">LibBlockInputSignal</a>(0, "", "", 0)>;    
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_else">%else</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(*uBuffer%<<span>pp</span>>)[%<<span>head</span>>] = %<<a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/blkiolib.html#LibBlockInputSignal">LibBlockInputSignal</a>(0, "", lcv, idx)>;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> isTransportdelay    
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> x = <a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/blocklib.html#LibBlockContinuousState">LibBlockContinuousState</a>("",lcv, idx)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;(*xBuffer%<<span>pp</span>>)[%<<span>head</span>>] = %<<span>x</span>>;          
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endroll">%endroll</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;/* when use fixed buffer, reset solver at when buffer is updated
 <br>&nbsp;&nbsp;&nbsp;&nbsp;* to avoid output consistency fail.
 <br>&nbsp;&nbsp;&nbsp;&nbsp;*/
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> isFixedbuf
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (bufferisfull){
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<span><a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/rtmdllib_obs.html#RTMSetBlockStateForSolverChangedAtMajorStep">RTMSetBlockStateForSolverChangedAtMajorStep</a>()</span>>;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<span><a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/rtmdllib_obs.html#RTMSetContTimeOutputInconsistentWithStateAtMajorStep">RTMSetContTimeOutputInconsistentWithStateAtMajorStep</a>()</span>>;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;}
 <br><span class="tlc_fkw">%endfunction</span> <span class="tlc_comment">%%End FcnVTDelayUpdate</span>
 <br>&nbsp; <br>&nbsp;&nbsp;&nbsp; <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span>Function:<span style="padding-left:9.5px"></span>FcnVTDerivatives<span style="padding-left:9.5px"></span>==================================================
</span> <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span>Abstract:
</span> <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span>For<span style="padding-left:9.5px"></span>the<span style="padding-left:9.5px"></span>variable<span style="padding-left:9.5px"></span>transport<span style="padding-left:9.5px"></span>delay<span style="padding-left:9.5px"></span>block,<span style="padding-left:9.5px"></span>get<span style="padding-left:9.5px"></span>the<span style="padding-left:9.5px"></span>derivative
</span> <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span>
</span> <br><span class="tlc_fkw">%function</span> <a id="Derivatives" class="tlc_func">Derivatives</a>(block, system) <span class="tlc_fkw">Output</span>
 <br>&nbsp;&nbsp;{
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> (ParamSettings.Transportdelay == "yes" ) 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;real_T instantDelay;
 <br>&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> rollVars = ["u1", "xdot", "<param>/MaximumDelay"]
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_roll">%roll</span> idx = RollRegions, lcv = 2, block, "Roller", rollVars
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%%      </span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;instantDelay = %<<a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/blkiolib.html#LibBlockInputSignal">LibBlockInputSignal</a>(1, "", lcv, idx)>;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> maxDelay = <a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/paramlib.html#LibBlockParameter">LibBlockParameter</a>(MaximumDelay, "", lcv, idx)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( instantDelay > %<<span>maxDelay</span>>) {
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;instantDelay = %<<span>maxDelay</span>>;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (instantDelay < 0.0) {
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/blocklib.html#LibBlockContinuousStateDerivative">LibBlockContinuousStateDerivative</a>("",lcv,idx)> = 0;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}else{ 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/blocklib.html#LibBlockContinuousStateDerivative">LibBlockContinuousStateDerivative</a>("",lcv,idx)> = 1.0/instantDelay;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endroll">%endroll</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_else">%else</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% For variable time delay, no state, do nothing</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;}
 <br><span class="tlc_fkw">%endfunction</span> <span class="tlc_comment">%%End FcnVTDerivatives</span>
 <br>&nbsp; <br>&nbsp; <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span>ForcingFunction<span style="padding-left:9.5px"></span>============================================================
</span> <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span>Abstract:
</span> <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span>When<span style="padding-left:9.5px"></span>part<span style="padding-left:9.5px"></span>of<span style="padding-left:9.5px"></span>linearly-implicit<span style="padding-left:9.5px"></span>model,<span style="padding-left:9.5px"></span>explicit<span style="padding-left:9.5px"></span>ODEs<span style="padding-left:9.5px"></span>
</span> <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span>have<span style="padding-left:9.5px"></span>ForcingFunction<span style="padding-left:9.5px"></span>==<span style="padding-left:9.5px"></span>Derivatives<span style="padding-left:9.5px"></span>
</span> <br><span class="tlc_comment">%%
</span> <br><span class="tlc_fkw">%function</span> <a id="ForcingFunction" class="tlc_func">ForcingFunction</a>(block, system) <span class="tlc_fkw">Output</span>
 <br>&nbsp;&nbsp;<span class="tlc_if">%if</span> ::CompiledModel.ModelIsLinearlyImplicit == "yes" 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;%<<a href="https://foool.github.io/r2020a/toolbox/simulink/simulink/private/sfunwiz_template.html#Derivatives">Derivatives</a>(block,system)>
 <br>&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br><span class="tlc_fkw">%endfunction</span>
 <br>&nbsp; <br><span class="tlc_comment">%%
</span> <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span>Function:<span style="padding-left:9.5px"></span>Terminate<span style="padding-left:9.5px"></span>========================================================
</span> <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span>Abstract:
</span> <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span>Free<span style="padding-left:9.5px"></span>PWorks<span style="padding-left:9.5px"></span>used<span style="padding-left:9.5px"></span>with<span style="padding-left:9.5px"></span>RSim<span style="padding-left:9.5px"></span>target
</span> <br><span class="tlc_comment">%%
</span> <br><span class="tlc_fkw">%function</span> <a id="Terminate" class="tlc_func">Terminate</a>(block, system) <span class="tlc_fkw">Output</span>
 <br>&nbsp;&nbsp;%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/blocks/tdelay_sup.html#TDelay_Terminate">TDelay_Terminate</a>(block, system)>
 <br><span class="tlc_fkw">%endfunction</span> <span class="tlc_comment">%% Terminate</span>
 <br>&nbsp; <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span>[EOF]<span style="padding-left:9.5px"></span><a href="https://foool.github.io/r2020a/rtw/c/tlc/blocks/vtdelay.html">vtdelay.tlc</a>
</span> <br></body></html>