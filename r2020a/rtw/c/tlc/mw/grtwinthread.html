<html>
<head>

<style>
p {
    color : black; font-family:courier; font-size: 80%;
}
body {
    line-height: 120%; font-family:courier; font-zize:60%;
}
.tlc_func {color : blue; font-weight: bold; font-size:120%;}
.tlc_comment {color : #9aa;}
.tlc_if {color: green;}.tlc_assign {color: green;}.tlc_each {color: green;}.tlc_foreach {color: green;}.tlc_endif {color: green;}.tlc_switch {color: green;}.tlc_case {color: green;}.tlc_return {color: green;}.tlc_elseif {color: green;}.tlc_else {color: green;}.tlc_assert {color: green;}.tlc_endwith {color: green;}.tlc_endforeach {color: green;}.tlc_generatefile {color: green;}.tlc_includepath {color: green;}.tlc_include {color: green;}.tlc_sprintf {color: green;}.tlc_while {color: green;}.tlc_endwhile {color: green;}.tlc_default {color: green;}.tlc_createrecord {color: green;}.tlc_mergerecord {color: green;}.tlc_language {color: green;}.tlc_roll {color: green;}.tlc_endroll {color: green;}.tlc_with {color: green;}.tlc_selectfile {color: green;}.tlc_openfile {color: green;}.tlc_closefile {color: green;}.tlc_def {color: green;}.tlc_undef {color: green;}.tlc_realformat {color: green;}.tlc_endswitch {color: green;}.tlc_addtorecord {color: green;}.tlc_break {color: green;}
.tlc_bifunc {color: brown;}
.tlc_fkw {color:blue; font-weight: 800;}
.tlc_output {color:#FFF; font-style:italic;}
.tlc_mchar {color:purple;}
</style>

</head>
<body>
<span class="tlc_comment">%%<span style="padding-left:9.5px"></span>==============================================================================
</span> <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span>
</span> <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span>
</span> <br><span class="tlc_comment">%%
</span> <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span>Abstract:
</span> <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span>Generation<span style="padding-left:9.5px"></span>of<span style="padding-left:9.5px"></span>threaded<span style="padding-left:9.5px"></span>GRT<span style="padding-left:9.5px"></span>main.c<span style="padding-left:9.5px"></span>file<span style="padding-left:9.5px"></span>with<span style="padding-left:9.5px"></span>Windows<span style="padding-left:9.5px"></span>threads
</span> <br><span class="tlc_comment">%%
</span> <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span>Copyright<span style="padding-left:9.5px"></span>1994-2014<span style="padding-left:9.5px"></span>The<span style="padding-left:9.5px"></span>MathWorks,<span style="padding-left:9.5px"></span>Inc.
</span> <br><span class="tlc_comment">%%
</span> <br><span class="tlc_selectfile">%selectfile</span> NULL_FILE
 <br>&nbsp; <br><span class="tlc_include">%include</span> "<a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html">commonthreadlib.tlc</a>"
 <br>&nbsp; <br><span class="tlc_fkw">%function</span> <a id="FcnDeclareProfileDataStruct" class="tlc_func">FcnDeclareProfileDataStruct</a>()
 <br>&nbsp;&nbsp;<span class="tlc_openfile">%openfile</span> retBuf
 <br>&nbsp;&nbsp;typedef struct {
 <br>&nbsp;&nbsp;&nbsp;&nbsp;int numSamples;  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;int maxNumSamples;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;double startTime[%<::CompiledModel.ConcurrentExecutionProfileNumSamples>];
 <br>&nbsp;&nbsp;&nbsp;&nbsp;double endTime[%<::CompiledModel.ConcurrentExecutionProfileNumSamples>];
 <br>&nbsp;&nbsp;&nbsp;&nbsp;int coreID[%<::CompiledModel.ConcurrentExecutionProfileNumSamples>];
 <br>&nbsp;&nbsp;} profileDataT;
 <br>&nbsp;&nbsp;<span class="tlc_closefile">%closefile</span> retBuf
 <br>&nbsp;&nbsp;<span class="tlc_return">%return</span> retBuf
 <br><span class="tlc_fkw">%endfunction</span>
 <br>&nbsp; <br><span class="tlc_fkw">%function</span> <a id="FcnDeclareProfileDataVar" class="tlc_func">FcnDeclareProfileDataVar</a>(numPeriodicMappedEntities, numPeriodicTriggers) 
 <br>&nbsp;&nbsp;<span class="tlc_openfile">%openfile</span> retBuf
 <br>&nbsp;&nbsp;profileDataT profileData[%<<span>numPeriodicMappedEntities</span>>]; 
 <br>&nbsp;&nbsp;int counterSamples[%<<span>numPeriodicTriggers</span>>]; 
 <br>&nbsp;&nbsp;<span class="tlc_closefile">%closefile</span> retBuf
 <br>&nbsp;&nbsp;<span class="tlc_return">%return</span> retBuf
 <br><span class="tlc_fkw">%endfunction</span>
 <br>&nbsp; <br><span class="tlc_fkw">%function</span> <a id="FcnGenerateProfilingFunctions" class="tlc_func">FcnGenerateProfilingFunctions</a>(numPeriodicMappedEntities)
 <br>&nbsp;&nbsp;<span class="tlc_openfile">%openfile</span> retBuf
 <br>&nbsp;&nbsp;double profileReadTimer(void) {
 <br>&nbsp;&nbsp;&nbsp;&nbsp;LARGE_INTEGER readTime;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;CHECK_STATUS(QueryPerformanceCounter(&amp;readTime) == false, "QueryPerformanceCounter");
 <br>&nbsp;&nbsp;&nbsp;&nbsp;return (double)(readTime.QuadPart);
 <br>&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;void initializeNumSamplesForProfiling(void) {
 <br>&nbsp;&nbsp;&nbsp;&nbsp;int idx;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;%<<span><a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/paralleldeploymentlib.html#SLibDeploymentDeclareSampleTimeHitIndexArrayForProfiling">SLibDeploymentDeclareSampleTimeHitIndexArrayForProfiling</a>()</span>>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;for (idx = 0; idx < %<<span>numPeriodicMappedEntities</span>>; idx++) {
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;profileData[idx].numSamples = 0;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;profileData[idx].maxNumSamples = (%<::CompiledModel.ConcurrentExecutionProfileNumSamples> -1) / sthId[idx] + 1;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;void profile_task_start(int taskId) {
 <br>&nbsp;&nbsp;&nbsp;&nbsp;if (profileData[taskId].numSamples < profileData[taskId].maxNumSamples) {
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;profileData[taskId].coreID[profileData[taskId].numSamples] = GetCurrentProcessorNumber();
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;profileData[taskId].startTime[profileData[taskId].numSamples] = profileReadTimer(); 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;} 
 <br>&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;void profile_task_end(int taskId) {  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;if (profileData[taskId].numSamples < profileData[taskId].maxNumSamples) {
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;profileData[taskId].endTime[profileData[taskId].numSamples] = profileReadTimer();  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;profileData[taskId].numSamples++;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;} 
 <br>&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/paralleldeploymentlib.html#SLibDeploymentWriteProfilingDataToHtml">SLibDeploymentWriteProfilingDataToHtml</a>(numPeriodicMappedEntities, TLC_TRUE)>
 <br>&nbsp;&nbsp;<span class="tlc_closefile">%closefile</span> retBuf
 <br>&nbsp;&nbsp;<span class="tlc_return">%return</span> retBuf
 <br><span class="tlc_fkw">%endfunction</span>
 <br>&nbsp; <br><span class="tlc_comment">%%==============================================================================
</span> <br><span class="tlc_fkw">%function</span> <a id="FcnGenerateUtilFunctionsAndGlobalVariables" class="tlc_func">FcnGenerateUtilFunctionsAndGlobalVariables</a>(numPeriodicTasks, ...
 <br>&nbsp;&nbsp;numAperiodicTasks, numPeriodicTriggers) void 
 <br>&nbsp;&nbsp;<span class="tlc_assign">%assign</span> numPeriodicMappedEntities = <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#SLibGetNumPeriodicMappedEntities">SLibGetNumPeriodicMappedEntities</a>()
 <br>&nbsp;&nbsp;<span class="tlc_openfile">%openfile</span> tmpFcnBuf
 <br>&nbsp;&nbsp;#define CHECK_STATUS(status,fcn) if (status != 0) {fprintf(stderr, "Call to %s returned error status (%d)./n", (fcn),(status)); perror((fcn)); fflush(stderr); exit(EXIT_FAILURE);}
 <br>&nbsp; <br>&nbsp;&nbsp;typedef struct {
 <br>&nbsp;&nbsp;&nbsp;&nbsp;HANDLE threadHandle;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;unsigned threadID;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;int_T index;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;HANDLE startEvent;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;HANDLE stopEvent;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;LONG exitFlag;
 <br>&nbsp;&nbsp;} ThreadInfo;
 <br>&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;<span class="tlc_if">%if</span> <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#SLibIsTaskProfilingOn">SLibIsTaskProfilingOn</a>()
 <br>&nbsp;&nbsp;&nbsp;&nbsp;%<<span><a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/ertposixthread.html#FcnDeclareProfileDataStruct">FcnDeclareProfileDataStruct</a>()</span>>
 <br>&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;<span class="tlc_if">%if</span> (numPeriodicTasks > 0)
 <br>&nbsp;&nbsp;ThreadInfo periodicThread[%<<span>numPeriodicTasks</span>>]; 
 <br>&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;ThreadInfo periodicTriggerThread[%<<span>numPeriodicTriggers</span>>];
 <br>&nbsp;&nbsp;<span class="tlc_if">%if</span> (numAperiodicTasks > 0)
 <br>&nbsp;&nbsp;ThreadInfo aperiodicThread[%<<span>numAperiodicTasks</span>>];
 <br>&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;int threadPriority[4] = { THREAD_PRIORITY_ABOVE_NORMAL, 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;THREAD_PRIORITY_NORMAL,
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;THREAD_PRIORITY_BELOW_NORMAL, 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;THREAD_PRIORITY_LOWEST };
 <br>&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;HANDLE rtClock[%<<span>numPeriodicTriggers</span>>];
 <br>&nbsp;&nbsp;HANDLE quitEvent = NULL; 
 <br>&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;<span class="tlc_if">%if</span> <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#SLibIsTaskProfilingOn">SLibIsTaskProfilingOn</a>()
 <br>&nbsp;&nbsp;&nbsp;&nbsp;%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/ertposixthread.html#FcnDeclareProfileDataVar">FcnDeclareProfileDataVar</a>(numPeriodicMappedEntities, numPeriodicTriggers)>
 <br>&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;<span class="tlc_if">%if</span> ::GenerateGRTWrapper  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;%<<span>Name</span>>_rtModel *S;
 <br>&nbsp;&nbsp;<span class="tlc_elseif">%elseif</span> !::GenerateClassInterface
 <br>&nbsp;&nbsp;&nbsp;&nbsp;%<::tSimStructType> *S;
 <br>&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;BOOL OnCtrlHandler(DWORD ctrl)
 <br>&nbsp;&nbsp;{  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;SetEvent(quitEvent);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;return true;
 <br>&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;<span class="tlc_if">%if</span> <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#SLibIsTaskProfilingOn">SLibIsTaskProfilingOn</a>()
 <br>&nbsp;&nbsp;&nbsp;&nbsp;%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/ertposixthread.html#FcnGenerateProfilingFunctions">FcnGenerateProfilingFunctions</a>(numPeriodicMappedEntities)>
 <br>&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;<span class="tlc_closefile">%closefile</span> tmpFcnBuf
 <br>&nbsp;&nbsp;%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/filepackaginglib.html#SLibCacheCodeToFile">SLibCacheCodeToFile</a>("mainSrc_data_defn", tmpFcnBuf)>
 <br><span class="tlc_fkw">%endfunction</span>
 <br>&nbsp; <br><span class="tlc_comment">%%==============================================================================
</span> <br><span class="tlc_fkw">%function</span> <a id="FcnGeneratePeriodicTaskSchedulerFunction" class="tlc_func">FcnGeneratePeriodicTaskSchedulerFunction</a>(ehIdx, nTasks, stopCheck) <span class="tlc_fkw">void</span> 
 <br>&nbsp;&nbsp;<span class="tlc_openfile">%openfile</span> tmpFcnBuf
 <br>&nbsp;&nbsp;unsigned __stdcall %<<a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibGetTriggerName">LibGetTriggerName</a>(ehIdx)>TaskScheduler(void *arg)
 <br>&nbsp;&nbsp;{
 <br>&nbsp;&nbsp;&nbsp;&nbsp;volatile boolean_T noErr;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;DWORD waitResult;    
 <br>&nbsp;&nbsp;&nbsp;&nbsp;HANDLE orTimer;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;LARGE_INTEGER orDueTime;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;HANDLE eventArray[2];
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> numTasks = <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibGetNumTriggerTasks">LibGetNumTriggerTasks</a>(ehIdx)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> (numTasks > 1)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> indexVar = "i" 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int_T %<<span>indexVar</span>>;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% Declare list of task indexes and task counters for tasks belonging to this</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% trigger</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> initStr  = ""
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> initStr2 = "" 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> initStr3 = ""
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> comma    = "" 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> triggerBaseRate = <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibGetTriggerBaseRate">LibGetTriggerBaseRate</a>(ehIdx)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_foreach">%foreach</span> taskIdx = numTasks
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> initStr  = initStr +"%<<span>comma</span>>0"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> initStr2 = initStr2 +"%<<span>comma</span>>%<<span>nTasks</span>>"  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> (numTasks > 1) &amp;&amp; (!RootSystemIsSingleRate)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> stIdx          = <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibGetTriggerTaskSampleTimeIndex">LibGetTriggerTaskSampleTimeIndex</a>(ehIdx, taskIdx)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> taskSampleTime = <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/codetemplatelib.html#LibGetSampleTimePeriodAndOffset">LibGetSampleTimePeriodAndOffset</a>(stIdx, 0)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> nTaskTicks     = <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/ertmdlreftiming.html#SLibComputeNumTaskTicks">SLibComputeNumTaskTicks</a>(taskSampleTime, ...
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;triggerBaseRate)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> initStr3 = initStr3 + "%<<span>comma</span>>%<<span>nTaskTicks</span>>"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> nTasks   = nTasks + 1
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> comma = ","
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endforeach">%endforeach</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> (numTasks > 1) &amp;&amp; (!RootSystemIsSingleRate)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int_T taskCounters[%<<span>numTasks</span>>] = {%<<span>initStr</span>>};   
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int_T taskTicks[%<<span>numTasks</span>>] = {%<<span>initStr3</span>>};
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;int_T taskId[%<<span>numTasks</span>>] = {%<<span>initStr2</span>>};
 <br>&nbsp;&nbsp;&nbsp;&nbsp;noErr              = %<<span>stopCheck</span>>;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;eventArray[0]      = quitEvent;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;eventArray[1]      = rtClock[%<<span>ehIdx</span>>];
 <br>&nbsp;&nbsp;&nbsp;&nbsp;orTimer            = CreateWaitableTimer(NULL, false, NULL);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;orDueTime.QuadPart = (LONGLONG)(%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibGetTriggerBaseRate">LibGetTriggerBaseRate</a>(ehIdx)> * 1e7 * -1);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;while (noErr)  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;{
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* Wait for the next event from the timer */
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;waitResult = WaitForMultipleObjects(2, eventArray, false, INFINITE);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((waitResult == WAIT_OBJECT_0) || (waitResult == WAIT_FAILED))
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* The quitEvent is set or the wait failed */
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;noErr = false;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHECK_STATUS(SetWaitableTimer(orTimer, &amp;orDueTime, 0, NULL, NULL, false) == false, "SetWaitableTimer");
 <br>&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> (numTasks > 1) 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (i = 0; i < %<<span>numTasks</span>>; i++)     
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> !RootSystemIsSingleRate
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (taskCounters[i] == 0)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;waitResult = WaitForSingleObject(periodicThread[taskId[i]].stopEvent, 0);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (waitResult == WAIT_TIMEOUT)  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{   
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> msg = "Overrun - rate for periodic task %d too fast."
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf("%<<span>msg</span>>/n", taskId[i]); 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WaitForSingleObject(periodicThread[taskId[i]].stopEvent, INFINITE);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> !RootSystemIsSingleRate
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_else">%else</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;waitResult = WaitForSingleObject(periodicThread[taskId[0]].stopEvent, 0);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (waitResult == WAIT_TIMEOUT)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{     
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> msg = "Overrun - rate for periodic task %d too fast."
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf("%<<span>msg</span>>/n", taskId[0]);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WaitForSingleObject(periodicThread[taskId[0]].stopEvent,INFINITE);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;noErr = %<<span>stopCheck</span>>; 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (noErr) 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#SLibIsTaskProfilingOn">SLibIsTaskProfilingOn</a>()      
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;counterSamples[%<<span>ehIdx</span>>]+=%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#SLibGetNumClockTicksForTrigger">SLibGetNumClockTicksForTrigger</a>(ehIdx)>;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> (numTasks > 1)  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (i = 0; i <%<<span>numTasks</span>>; i++)     
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{   
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> !RootSystemIsSingleRate
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (taskCounters[i] == 0)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetEvent(periodicThread[taskId[i]].startEvent); 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> !RootSystemIsSingleRate
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_else">%else</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetEvent(periodicThread[taskId[0]].startEvent);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% Advance task counters</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> (numTasks > 1) &amp;&amp; (!RootSystemIsSingleRate)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (i = 0; i <%<<span>numTasks</span>>; i++) {     
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;taskCounters[i]++;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (taskCounters[i] > (taskTicks[i]-1)) {
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;taskCounters[i] = 0;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> (numTasks > 1) &amp;&amp; (!RootSystemIsSingleRate)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (i = 0; i < %<<span>numTasks</span>>; i++)     
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (taskCounters[i] != 0)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WaitForSingleObject(periodicThread[taskId[i]].stopEvent,INFINITE);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (WaitForSingleObject(orTimer, 0) == WAIT_OBJECT_0)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> msg = "Overrun - periodic trigger %<<span>ehIdx</span>> base rate too fast."
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf("%<<span>msg</span>>/n");
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;} /* while */
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> (numTasks > 1)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;for (i = 0; i < %<<span>numTasks</span>>; i++) 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;{
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InterlockedIncrement(&amp;periodicThread[taskId[i]].exitFlag);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetEvent(periodicThread[taskId[i]].startEvent);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_else">%else</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;InterlockedIncrement(&amp;periodicThread[taskId[0]].exitFlag);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;SetEvent(periodicThread[taskId[0]].startEvent);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;_endthreadex(0);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;return 0;
 <br>&nbsp;&nbsp;}
 <br>&nbsp; <br>&nbsp;&nbsp;<span class="tlc_closefile">%closefile</span> tmpFcnBuf
 <br>&nbsp;&nbsp;%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/filepackaginglib.html#SLibCacheCodeToFile">SLibCacheCodeToFile</a>("mainSrc_fcn_defn",tmpFcnBuf)>
 <br><span class="tlc_fkw">%endfunction</span>
 <br>&nbsp; <br><span class="tlc_comment">%%==============================================================================
</span> <br><span class="tlc_fkw">%function</span> <a id="FcnGeneratePeriodicTriggerFunction" class="tlc_func">FcnGeneratePeriodicTriggerFunction</a>(ehIdx, stopCheck)   
 <br>&nbsp;&nbsp;<span class="tlc_openfile">%openfile</span> retBuf
 <br>&nbsp;&nbsp;unsigned __stdcall %<<a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibGetTriggerName">LibGetTriggerName</a>(ehIdx)>(void *arg)
 <br>&nbsp;&nbsp;{
 <br>&nbsp;&nbsp;&nbsp;&nbsp;volatile boolean_T noErr;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;DWORD waitResult;    
 <br>&nbsp;&nbsp;&nbsp;&nbsp;HANDLE orTimer;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;LARGE_INTEGER orDueTime;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;HANDLE eventArray[2];
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#SLibIsTaskProfilingOn">SLibIsTaskProfilingOn</a>()
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ThreadInfo* info   = (ThreadInfo*)arg;   
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_else">%else</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* Unused arguments */
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(void)(arg);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;noErr              = %<<span>stopCheck</span>>;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;eventArray[0]      = quitEvent;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;eventArray[1]      = rtClock[%<<span>ehIdx</span>>];
 <br>&nbsp;&nbsp;&nbsp;&nbsp;orTimer            = CreateWaitableTimer(NULL, false, NULL);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;orDueTime.QuadPart = (LONGLONG)(%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibGetTriggerBaseRate">LibGetTriggerBaseRate</a>(ehIdx)> * 1e7 * -1);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;while (noErr)  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;{
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* Wait for the next event from the timer */
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;waitResult = WaitForMultipleObjects(2, eventArray, false, INFINITE);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((waitResult == WAIT_OBJECT_0) || (waitResult == WAIT_FAILED))
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* The quitEvent is set or the wait failed */
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;noErr = false;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHECK_STATUS(SetWaitableTimer(orTimer, &amp;orDueTime, 0, NULL, NULL, false) == false, "SetWaitableTimer");
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;noErr = %<<span>stopCheck</span>>;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (noErr) 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#SLibIsTaskProfilingOn">SLibIsTaskProfilingOn</a>()     
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;counterSamples[%<<span>ehIdx</span>>]+=%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#SLibGetNumClockTicksForTrigger">SLibGetNumClockTicksForTrigger</a>(ehIdx)>;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#SLibIsTaskProfilingOn">SLibIsTaskProfilingOn</a>()
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;profile_task_start(info->index);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibCallTriggerISR">LibCallTriggerISR</a>(ehIdx)>    
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#SLibIsTaskProfilingOn">SLibIsTaskProfilingOn</a>()
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;profile_task_end(info->index);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span> 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;} /* while */
 <br>&nbsp;&nbsp;&nbsp;&nbsp;_endthreadex(0);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;return 0;  
 <br>&nbsp;&nbsp;}  
 <br>&nbsp;&nbsp;<span class="tlc_closefile">%closefile</span> retBuf
 <br>&nbsp;&nbsp;<span class="tlc_return">%return</span> retBuf
 <br><span class="tlc_fkw">%endfunction</span>
 <br>&nbsp; <br><span class="tlc_comment">%%==============================================================================
</span> <br><span class="tlc_fkw">%function</span> <a id="FcnGeneratePeriodicTaskWrapperFunctions" class="tlc_func">FcnGeneratePeriodicTaskWrapperFunctions</a>(numPeriodicTasks, numPeriodicTriggers) <span class="tlc_fkw">void</span>
 <br>&nbsp;&nbsp;<span class="tlc_assign">%assign</span> stopCheck = "(%<<span><a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/rtmdllib_obs.html#RTMGetErrStat">RTMGetErrStat</a>()</span>> == %<<span><a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/utillib.html#SLibGetNullDefinitionFromTfl">SLibGetNullDefinitionFromTfl</a>()</span>>)" 
 <br>&nbsp;&nbsp;<span class="tlc_if">%if</span> <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/rtmdllib_obs.html#RTMStopReqAccessed">RTMStopReqAccessed</a>()
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> stopCheck = stopCheck + " &amp;&amp; !%<<span><a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/rtmdllib_obs.html#RTMGetStopRequested">RTMGetStopRequested</a>()</span>>"
 <br>&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp; <br>&nbsp;&nbsp;<span class="tlc_openfile">%openfile</span> tmpFcnBuf 
 <br>&nbsp;&nbsp;<span class="tlc_if">%if</span> (numPeriodicTasks > 0)
 <br>&nbsp;&nbsp;unsigned __stdcall periodicTask(void *arg)
 <br>&nbsp;&nbsp;{
 <br>&nbsp;&nbsp;&nbsp;&nbsp;DWORD waitResult;  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;ThreadInfo* info         = (ThreadInfo*)arg;   
 <br>&nbsp;&nbsp;&nbsp;&nbsp;volatile boolean_T noErr = true;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;while (noErr) 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;{         
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;waitResult = WaitForSingleObject(info->startEvent,INFINITE);  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((waitResult != WAIT_OBJECT_0) || info->exitFlag)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* Wait failed or exitFlag is set */
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;noErr = false;   
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#SLibIsTaskProfilingOn">SLibIsTaskProfilingOn</a>()
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;profile_task_start(info->index);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>    
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> ::GenerateGRTWrapper || !<a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/sysbodlib.html#SLibSingleTasking">SLibSingleTasking</a>()
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MdlOutputs(info->index);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MdlUpdate(info->index); 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_else">%else</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MdlOutputs();
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MdlUpdate();
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#SLibIsTaskProfilingOn">SLibIsTaskProfilingOn</a>()
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;profile_task_end(info->index);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetEvent(info->stopEvent);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;}  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;_endthreadex(0);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;return 0;  
 <br>&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;<span class="tlc_assign">%assign</span> taskCounter = 0
 <br>&nbsp;&nbsp;<span class="tlc_comment">%% Generate task schedulers per periodic group</span>
 <br>&nbsp;&nbsp;<span class="tlc_foreach">%foreach</span> ehIdx = <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibGetNumTriggers">LibGetNumTriggers</a>()
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> evType = <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibGetTriggerType">LibGetTriggerType</a>(ehIdx)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> <span class="tlc_bifunc">ISEQUAL</span>(evType, "AperiodicTrigger") 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_continue">%continue</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#SLibIsTaskProfilingOn">SLibIsTaskProfilingOn</a>()   
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> finalStopCheck = stopCheck + " &amp;&amp; (counterSamples[%<<span>ehIdx</span>>] < %<::CompiledModel.ConcurrentExecutionProfileNumSamples>)"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_else">%else</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> finalStopCheck = stopCheck
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> !<span class="tlc_bifunc">ISEQUAL</span>(<a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibGetNumTriggerTasks">LibGetNumTriggerTasks</a>(ehIdx), 0)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/ertposixthread.html#FcnGeneratePeriodicTaskSchedulerFunction">FcnGeneratePeriodicTaskSchedulerFunction</a>(ehIdx, taskCounter, ...
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;finalStopCheck)>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> taskCounter = taskCounter + <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibGetNumTriggerTasks">LibGetNumTriggerTasks</a>(ehIdx)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_else">%else</span> 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assert">%assert</span> <span class="tlc_bifunc">ISEQUAL</span>(<a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibGetTriggerHandlerType">LibGetTriggerHandlerType</a>(ehIdx), "isr")
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/ertposixthread.html#FcnGeneratePeriodicTriggerFunction">FcnGeneratePeriodicTriggerFunction</a>(ehIdx, finalStopCheck)>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp; <br>&nbsp;&nbsp;<span class="tlc_endforeach">%endforeach</span> <span class="tlc_comment">%% end for each periodic trigger</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;<span class="tlc_closefile">%closefile</span> tmpFcnBuf
 <br>&nbsp;&nbsp;%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/filepackaginglib.html#SLibCacheCodeToFile">SLibCacheCodeToFile</a>("mainSrc_fcn_defn",tmpFcnBuf)>
 <br><span class="tlc_fkw">%endfunction</span>
 <br>&nbsp; <br><span class="tlc_comment">%%==============================================================================
</span> <br><span class="tlc_fkw">%function</span> <a id="FcnGenerateAperiodicWrapperFunctions" class="tlc_func">FcnGenerateAperiodicWrapperFunctions</a>() <span class="tlc_fkw">void</span>
 <br>&nbsp;&nbsp;<span class="tlc_openfile">%openfile</span> tmpFcnBuf 
 <br>&nbsp;&nbsp;<span class="tlc_foreach">%foreach</span> aehIdx = <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibGetNumTriggers">LibGetNumTriggers</a>()
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> evType = <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibGetTriggerType">LibGetTriggerType</a>(aehIdx)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> <span class="tlc_bifunc">ISEQUAL</span>(evType, "PeriodicTrigger")
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_continue">%continue</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> targetObj = <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibGetTriggerTargetObject">LibGetTriggerTargetObject</a>(aehIdx)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> aehName   = <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibGetTriggerName">LibGetTriggerName</a>(aehIdx)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> type      = <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibGetTriggerHandlerType">LibGetTriggerHandlerType</a>(aehIdx)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assert">%assert</span> <span class="tlc_bifunc">ISEQUAL</span>(type, "task") || <span class="tlc_bifunc">ISEQUAL</span>(type, "isr")
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> <span class="tlc_bifunc">ISEQUAL</span>(type, "task")
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_foreach">%foreach</span> taskIdx = <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibGetNumTriggerTasks">LibGetNumTriggerTasks</a>(aehIdx)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned __stdcall %<<span>aehName</span>>_%<<span>taskIdx</span>>(void *arg) 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DWORD waitResult; 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HANDLE eventArray[2];
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ThreadInfo* info         = (ThreadInfo*)arg; 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;volatile boolean_T noErr = true; 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eventArray[0]            = quitEvent;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eventArray[1]            = info->startEvent;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while (noErr)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;waitResult = WaitForMultipleObjects(2, eventArray, false, INFINITE);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((waitResult == WAIT_FAILED) || (waitResult == WAIT_OBJECT_0)) 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;noErr = false;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibCallTriggerTask">LibCallTriggerTask</a>(aehIdx, taskIdx)>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_endthreadex(0);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 0;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endforeach">%endforeach</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_else">%else</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% Generate ISR </span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> isrFuncName = "eventHandler_%<<span>aehName</span>>"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* Software Interrupt */
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned __stdcall %<<span>isrFuncName</span>>(void *arg)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DWORD waitResult;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HANDLE eventArray[2];
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ThreadInfo* info         = (ThreadInfo*)arg; 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;volatile boolean_T noErr = true;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eventArray[0]            = quitEvent;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eventArray[1]            = info->startEvent;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while (noErr) 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;waitResult = WaitForMultipleObjects(2, eventArray, false, INFINITE);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((waitResult == WAIT_FAILED) || (waitResult == WAIT_OBJECT_0))
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;noErr = false;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibCallTriggerISR">LibCallTriggerISR</a>(aehIdx)> 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_endthreadex(0);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 0;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;<span class="tlc_endforeach">%endforeach</span>  
 <br>&nbsp;&nbsp;<span class="tlc_closefile">%closefile</span> tmpFcnBuf
 <br>&nbsp;&nbsp;%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/filepackaginglib.html#SLibCacheCodeToFile">SLibCacheCodeToFile</a>("mainSrc_fcn_defn",tmpFcnBuf)>
 <br><span class="tlc_fkw">%endfunction</span>
 <br>&nbsp;&nbsp; <br><span class="tlc_comment">%%==============================================================================
</span> <br><span class="tlc_fkw">%function</span> <a id="FcnDeclareTaskPriorities" class="tlc_func">FcnDeclareTaskPriorities</a>(numAperiodicTasks, coreAffinityRequired) 
 <br>&nbsp;&nbsp;<span class="tlc_comment">%% Declare threads priority based on rate monotonic assignment</span>
 <br>&nbsp;&nbsp;<span class="tlc_assign">%assign</span> asyncPr = 0
 <br>&nbsp;&nbsp;<span class="tlc_if">%if</span> (numAperiodicTasks > 0)  <span class="tlc_comment">%% Reserve highest priority to async</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> asyncPr = 1
 <br>&nbsp;&nbsp;<span class="tlc_endif">%endif</span>    
 <br>&nbsp;&nbsp;<span class="tlc_openfile">%openfile</span> tmpBuf
 <br>&nbsp;&nbsp;<span class="tlc_assign">%assign</span> stIdRMSTaskWithLowPrio = -1 
 <br>&nbsp;&nbsp;<span class="tlc_assign">%assign</span> isCorrectRMS           = TLC_TRUE
 <br>&nbsp;&nbsp;<span class="tlc_assign">%assign</span> idx = 0
 <br>&nbsp;&nbsp;<span class="tlc_if">%if</span> coreAffinityRequired
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> maxNumberOfCoresPerTask = <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#SLibGetMaxNumberOfCoresPerTask">SLibGetMaxNumberOfCoresPerTask</a>()
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assert">%assert</span> maxNumberOfCoresPerTask > 0
 <br>&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;<span class="tlc_foreach">%foreach</span> ehIdx = <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibGetNumTriggers">LibGetNumTriggers</a>()
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> evType = <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibGetTriggerType">LibGetTriggerType</a>(ehIdx)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> <span class="tlc_bifunc">ISEQUAL</span>(evType, "AperiodicTrigger")
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_continue">%continue</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_foreach">%foreach</span> taskIdx = <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibGetNumTriggerTasks">LibGetNumTriggerTasks</a>(ehIdx)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> stId = <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibGetTriggerTaskSampleTimeIndex">LibGetTriggerTaskSampleTimeIndex</a>(ehIdx, taskIdx) + asyncPr 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> stId = stId - <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/codetemplatelib.html#LibGetTID01EQ">LibGetTID01EQ</a>()
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> (stId < 3)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;priority[%<<span>idx</span>>] = threadPriority[%<<span>stId</span>>];
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_else">%else</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#SLibIsTaskRateMonotonic">SLibIsTaskRateMonotonic</a>(ehIdx, taskIdx)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> <span class="tlc_bifunc">ISEQUAL</span>(stIdRMSTaskWithLowPrio, -1)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% First rate monotonic task with lowest priority</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> stIdRMSTaskWithLowPrio = stId
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_elseif">%elseif</span> !<span class="tlc_bifunc">ISEQUAL</span>(stIdRMSTaskWithLowPrio, stId)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% At least 2 rate motonic tasks with lowest priority and different rates</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> isCorrectRMS = TLC_FALSE
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;priority[%<<span>idx</span>>] = threadPriority[3];
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> coreAffinityRequired
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> affinity = <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibGetTaskCoreAffinity">LibGetTaskCoreAffinity</a>(ehIdx, taskIdx)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_foreach">%foreach</span> index = maxNumberOfCoresPerTask
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> <span class="tlc_bifunc">ISEMPTY</span>(affinity) || <span class="tlc_bifunc">SIZE</span>(affinity,1)-1 < index
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;coreAffinity[%<<span>idx</span>>][%<<span>index</span>>] = -1;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_else">%else</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;coreAffinity[%<<span>idx</span>>][%<<span>index</span>>] = %<affinity[index]>;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endforeach">%endforeach</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> idx = idx + 1
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endforeach">%endforeach</span>      
 <br>&nbsp;&nbsp;<span class="tlc_endforeach">%endforeach</span>
 <br>&nbsp;&nbsp;<span class="tlc_if">%if</span> !isCorrectRMS  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;printf("There is a risk in running the generated code correctly because /n");
 <br>&nbsp;&nbsp;&nbsp;&nbsp;printf("the number of tasks with different periods that require rate monotonic /n");
 <br>&nbsp;&nbsp;&nbsp;&nbsp;printf("scheduling is larger than three. Consider reducing the number of rate /n");
 <br>&nbsp;&nbsp;&nbsp;&nbsp;printf("monotonic tasks in the model.");
 <br>&nbsp;&nbsp;&nbsp;&nbsp;fflush(stdout);
 <br>&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;<span class="tlc_closefile">%closefile</span> tmpBuf
 <br>&nbsp;&nbsp;<span class="tlc_return">%return</span> tmpBuf
 <br><span class="tlc_fkw">%endfunction</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br><span class="tlc_comment">%%==============================================================================
</span> <br><span class="tlc_fkw">%function</span> <a id="FcnGenerateMainFunction" class="tlc_func">FcnGenerateMainFunction</a>(numPeriodicTasks, numAperiodicTasks, ...
 <br>&nbsp;&nbsp;numPeriodicTriggers) void
 <br>&nbsp;&nbsp;<span class="tlc_assign">%assign</span> coreAffinityRequired = <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibIsCoreAffinityRequired">LibIsCoreAffinityRequired</a>()
 <br>&nbsp;&nbsp;<span class="tlc_openfile">%openfile</span> tmpFcnBuf
 <br>&nbsp;&nbsp;int main(int argc, char *argv[])
 <br>&nbsp;&nbsp;{ 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> !<a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/utillib.html#SLibIsERTTarget">SLibIsERTTarget</a>() &amp;&amp; GenerateGRTWrapper
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> statusVar = "status"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const char_T *%<<span>statusVar</span>>;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> coreAffinityRequired
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int i, j;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_else">%else</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int i;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;LARGE_INTEGER stNanoSec;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;LONG stMilliPeriod;  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> (numPeriodicTasks > 0)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> coreAffinityRequired
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SYSTEM_INFO sysinfo;  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DWORD_PTR processMask;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DWORD_PTR systemMask;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DWORD_PTR threadMask;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> maxNumberOfCoresPerTask = <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#SLibGetMaxNumberOfCoresPerTask">SLibGetMaxNumberOfCoresPerTask</a>()
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assert">%assert</span> maxNumberOfCoresPerTask > 0
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int coreAffinity[%<<span>numPeriodicTasks</span>>][%<<span>maxNumberOfCoresPerTask</span>>];
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int numCores;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;int priority[%<<span>numPeriodicTasks</span>>];   
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;/* Unused arguments */
 <br>&nbsp;&nbsp;&nbsp;&nbsp;(void)(argc);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;(void)(argv);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% Declare threads priority based on rate monotonic assignment</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/ertwinthread.html#FcnDeclareTaskPriorities">FcnDeclareTaskPriorities</a>(numAperiodicTasks, coreAffinityRequired)>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;CHECK_STATUS(SetConsoleCtrlHandler((PHANDLER_ROUTINE)OnCtrlHandler, true) == false, "SetConsoleCtrlHandler");
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_comment">%% Initialize timers </span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;for (i = 0; i < %<<span>numPeriodicTriggers</span>>; i++) {
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rtClock[i] = NULL;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#SLibIsTaskProfilingOn">SLibIsTaskProfilingOn</a>()
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (i = 0 ; i < %<<span>numPeriodicTriggers</span>>; i++) {
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;counterSamples[i] = 0;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initializeNumSamplesForProfiling();
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;printf("**starting the model**/n");      
 <br>&nbsp;&nbsp;&nbsp;&nbsp;fflush(stdout);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> !SuppressErrorStatus
 <br>&nbsp;&nbsp;&nbsp;&nbsp;%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/rtmdllib_obs.html#RTMSetErrStat">RTMSetErrStat</a>(0)>;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>   
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;/* Set the priority of the main thread */
 <br>&nbsp;&nbsp;&nbsp;&nbsp;CHECK_STATUS(SetThreadPriority(GetCurrentThread(),THREAD_PRIORITY_TIME_CRITICAL) == false, "SetThreadPriority");
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;/* Create &amp; initialize events used for thread synchronization */
 <br>&nbsp;&nbsp;&nbsp;&nbsp;quitEvent = CreateEvent(NULL, true, false, NULL);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;CHECK_STATUS(quitEvent == NULL,"CreateEvent");
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;for (i = 0; i < %<<span>numPeriodicTriggers</span>>; i++) {
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rtClock[i] = CreateWaitableTimer(NULL, false, NULL);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHECK_STATUS(rtClock[i] == NULL,"CreateWaitableTimer");
 <br>&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;/************************
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* Initialize the model *
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;************************/
 <br>&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> ::GenerateGRTWrapper
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;S = %<<span>Name</span>>();
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_elseif">%elseif</span> ::UsingMalloc
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<::tSimStruct> = %<<span>Name</span>>();
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (%<::tSimStruct> == NULL) {
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;puts("Memory allocation error during model "
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"registration");
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return(EXIT_FAILURE);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;S = %<::tSimStruct>;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_elseif">%elseif</span> ::GenerateClassInterface
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<span><a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/ertmainlib.html#FcnGenerateModelInitialize">FcnGenerateModelInitialize</a>()</span>> 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_else">%else</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;S = %<::tSimStruct>;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<span><a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/codetemplatelib.html#LibCallModelInitialize">LibCallModelInitialize</a>()</span>>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;if (%<<span><a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/rtmdllib_obs.html#RTMGetErrStat">RTMGetErrStat</a>()</span>> != %<<span><a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/utillib.html#SLibGetNullDefinitionFromTfl">SLibGetNullDefinitionFromTfl</a>()</span>>) 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;{
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;puts("Error during model registration");
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit(EXIT_FAILURE);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> ::GenerateGRTWrapper
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> ::CompiledModel.StopTime == rtInf
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rtmSetTFinal(S, -1.0);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_else">%else</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rtmSetTFinal(S, %<::CompiledModel.StopTime>);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;MdlInitializeSizes();
 <br>&nbsp;&nbsp;&nbsp;&nbsp;MdlInitializeSampleTimes();
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> !<a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/utillib.html#SLibIsERTTarget">SLibIsERTTarget</a>() &amp;&amp; ::GenerateGRTWrapper
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<span>statusVar</span>> = rt_SimInitTimingEngine(rtmGetNumSampleTimes(S),
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rtmGetStepSize(S),
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rtmGetSampleTimePtr(S),
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rtmGetOffsetTimePtr(S),
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rtmGetSampleHitPtr(S),
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rtmGetSampleTimeTaskIDPtr(S),
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rtmGetTStart(S),
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;rtmGetSimTimeStep(S),
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;rtmGetTimingData(S));
 <br>&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (%<<span>statusVar</span>> != NULL) 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;puts("Failed to initialize sample time engine");
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit(EXIT_FAILURE);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;MdlStart(); 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> (numPeriodicTasks > 0)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> coreAffinityRequired
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GetSystemInfo(&amp;sysinfo);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;numCores = sysinfo.dwNumberOfProcessors;  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHECK_STATUS(GetProcessAffinityMask(GetCurrentProcess(), &amp;processMask, &amp;systemMask) == FALSE, "GetProcessAffinityMask");
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;/* Create periodic threads */
 <br>&nbsp;&nbsp;&nbsp;&nbsp;for (i = 0; i < %<<span>numPeriodicTasks</span>>; i++)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;{ 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;periodicThread[i].index = (int_T) i;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;periodicThread[i].exitFlag = 0;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* Create the events that will be used by the thread */
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;periodicThread[i].startEvent = CreateEvent(NULL, false, false, NULL);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHECK_STATUS(periodicThread[i].startEvent == NULL, "CreateEvent");
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;periodicThread[i].stopEvent = CreateEvent(NULL, false, true, NULL);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHECK_STATUS(periodicThread[i].stopEvent == NULL, "CreateStopEventEvent");
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* Create the thread in suspended mode */
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;periodicThread[i].threadHandle = (HANDLE)_beginthreadex(NULL, 0, &amp;periodicTask, &amp;periodicThread[i], CREATE_SUSPENDED, &amp;periodicThread[i].threadID);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHECK_STATUS(periodicThread[i].threadID == 0,"_beginthreadex");
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* Set the thread priority */
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHECK_STATUS(SetThreadPriority(periodicThread[i].threadHandle, priority[i]) == false, "SetThreadPriority");
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> coreAffinityRequired
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* Create the thread mask */
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;threadMask = 0;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(j = 0; j < %<<span>maxNumberOfCoresPerTask</span>>; j++) {
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((coreAffinity[i][j] >= 0) &amp;&amp; (coreAffinity[i][j] < numCores))
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* Set the (coreAffinity[i][j]+1)th rightmost bit in threadMask */
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;threadMask |= (1 << coreAffinity[i][j]);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* Set the core affinity */
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (threadMask != 0)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHECK_STATUS(SetThreadAffinityMask(periodicThread[i].threadHandle, threadMask) == 0, "SetThreadAffinityMask");
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* Start the thread */
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHECK_STATUS(ResumeThread(periodicThread[i].threadHandle) == -1,"ResumeThread");
 <br>&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span> <span class="tlc_comment">%% if (numPeriodicTasks > 0)    </span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;/* Create periodic trigger threads */    
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> periodicThreadIDCounter = 0
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_foreach">%foreach</span> ehIdx = <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibGetNumTriggers">LibGetNumTriggers</a>()
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> evType = <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibGetTriggerType">LibGetTriggerType</a>(ehIdx)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> <span class="tlc_bifunc">ISEQUAL</span>(evType, "AperiodicTrigger") 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_continue">%continue</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> <span class="tlc_bifunc">ISEQUAL</span>(<a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibGetNumTriggerTasks">LibGetNumTriggerTasks</a>(ehIdx), 0)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> threadFcnName           = "%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibGetTriggerName">LibGetTriggerName</a>(ehIdx)>"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> argStr                  = "&amp;periodicTriggerThread[%<<span>ehIdx</span>>]"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> index                   = numPeriodicTasks + periodicThreadIDCounter
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> periodicThreadIDCounter = periodicThreadIDCounter + 1
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_else">%else</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> threadFcnName = "%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibGetTriggerName">LibGetTriggerName</a>(ehIdx)>TaskScheduler"  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> argStr        = "NULL"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> index         = "0"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;periodicTriggerThread[%<<span>ehIdx</span>>].index = %<<span>index</span>>;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;periodicTriggerThread[%<<span>ehIdx</span>>].exitFlag = 0;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;periodicTriggerThread[%<<span>ehIdx</span>>].startEvent = NULL;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;periodicTriggerThread[%<<span>ehIdx</span>>].stopEvent = NULL;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* Create the thread in suspended mode */
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;periodicTriggerThread[%<<span>ehIdx</span>>].threadHandle = (HANDLE)_beginthreadex(NULL, 0, &amp;%<<span>threadFcnName</span>>, %<<span>argStr</span>>, CREATE_SUSPENDED, &amp;periodicTriggerThread[%<<span>ehIdx</span>>].threadID);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHECK_STATUS(periodicTriggerThread[%<<span>ehIdx</span>>].threadHandle == 0,"_beginthreadex");
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* Set the periodic trigger thread priority */
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHECK_STATUS(SetThreadPriority(periodicTriggerThread[%<<span>ehIdx</span>>].threadHandle,THREAD_PRIORITY_HIGHEST) == false, "SetThreadPriority");
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* Start the periodic trigger thread */
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHECK_STATUS(ResumeThread(periodicTriggerThread[%<<span>ehIdx</span>>].threadHandle) == -1,"ResumeThread");
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endforeach">%endforeach</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> (numAperiodicTasks > 0)  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> idx = 0
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_foreach">%foreach</span> aehIdx = <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibGetNumTriggers">LibGetNumTriggers</a>()
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> evType = <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibGetTriggerType">LibGetTriggerType</a>(aehIdx)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> <span class="tlc_bifunc">ISEQUAL</span>(evType, "PeriodicTrigger")
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_continue">%continue</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> type      = <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibGetTriggerHandlerType">LibGetTriggerHandlerType</a>(aehIdx) 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> targetObj = <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibGetTriggerTargetObject">LibGetTriggerTargetObject</a>(aehIdx)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> !<span class="tlc_bifunc">ISFIELD</span>(targetObj, "EventName")
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> errTxt = "Unsupported aperiodic event for native threads."
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/utillib.html#LibReportFatalError">LibReportFatalError</a>(errTxt)>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> eventName = targetObj.EventName
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> aehName   = <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibGetTriggerName">LibGetTriggerName</a>(aehIdx)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> <span class="tlc_bifunc">ISEQUAL</span>(type, "task")    
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assert">%assert</span> <span class="tlc_bifunc">ISEQUAL</span>(<a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibGetNumTriggerTasks">LibGetNumTriggerTasks</a>(aehIdx), 1)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> taskIdx = 0
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> isrFcnName = "%<<span>aehName</span>>_%<<span>taskIdx</span>>"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* Create aperiodic thread */ 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_else">%else</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* Create thread for aperiodic trigger */ 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> isrFcnName = "eventHandler_%<<span>aehName</span>>"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aperiodicThread[%<<span>idx</span>>].index = %<<span>idx</span>>;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aperiodicThread[%<<span>idx</span>>].exitFlag = 0;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aperiodicThread[%<<span>idx</span>>].stopEvent = NULL;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* Create the event that will trigger the execution of the thread */
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aperiodicThread[%<<span>idx</span>>].startEvent = CreateEvent(NULL, false, false, "%<<span>eventName</span>>");
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHECK_STATUS(aperiodicThread[%<<span>idx</span>>].startEvent == NULL, "CreateEvent%<<span>eventName</span>>");           
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* Create the thread in suspended mode */
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aperiodicThread[%<<span>idx</span>>].threadHandle = (HANDLE)_beginthreadex(NULL, 0, &amp;%<<span>isrFcnName</span>>, &amp;aperiodicThread[%<<span>idx</span>>], CREATE_SUSPENDED, &amp;aperiodicThread[%<<span>idx</span>>].threadID);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHECK_STATUS(aperiodicThread[%<<span>idx</span>>].threadID == 0,"_beginthreadex");
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* Set the thread priority */
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHECK_STATUS(SetThreadPriority(aperiodicThread[%<<span>idx</span>>].threadHandle, priority[0]) == false, "SetThreadPriority");
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* Start the thread */
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHECK_STATUS(ResumeThread(aperiodicThread[%<<span>idx</span>>].threadHandle) == -1,"ResumeThread");
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> idx = idx + 1
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endforeach">%endforeach</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;/* Real-time scheduling timer */ 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_foreach">%foreach</span> ehIdx = <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibGetNumTriggers">LibGetNumTriggers</a>() 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> evType = <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibGetTriggerType">LibGetTriggerType</a>(ehIdx)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> <span class="tlc_bifunc">ISEQUAL</span>(evType, "AperiodicTrigger") 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_continue">%continue</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> period = %<<a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibGetTriggerBaseRate">LibGetTriggerBaseRate</a>(ehIdx)> 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> ((period * 1000) < 1) 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> <a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/utillib.html#LibIsDeploymentDiagram">LibIsDeploymentDiagram</a>()
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> errormsg = "The periodic trigger %<<a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibGetTriggerName">LibGetTriggerName</a>(ehIdx)> of model %<::CompiledModel.Name> has a base rate smaller than 1 ms. The current base rate is %<<span>period</span>> seconds. Increase the base rate of the periodic trigger by increasing the rate in the model."
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_else">%else</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> errormsg = "%<::CompiledModel.Name> has a base rate smaller than 1 ms. The current base rate is %<<span>period</span>> seconds. Increase the base rate of the model."
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_exit">%exit</span> %<<span>errormsg</span>>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stNanoSec.QuadPart = (LONGLONG)(%<<span>period</span>> * 1e7 * -1);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stMilliPeriod      = (LONG)(%<<span>period</span>> * 1e3);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHECK_STATUS(SetWaitableTimer(rtClock[%<<span>ehIdx</span>>], &amp;stNanoSec, stMilliPeriod, NULL, NULL, false) == false, "SetWaitableTimer");
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endforeach">%endforeach</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;/* Wait for a stopping condition. */
 <br>&nbsp;&nbsp;&nbsp;&nbsp;for (i = 0; i < %<<span>numPeriodicTriggers</span>>; i++) {
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WaitForSingleObject(periodicTriggerThread[i].threadHandle, INFINITE);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;/* Clean up */
 <br>&nbsp;&nbsp;&nbsp;&nbsp;for (i = 0; i< %<<span>numPeriodicTriggers</span>>; i++)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;{
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (rtClock[i] != NULL) 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle(rtClock[i]);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (periodicTriggerThread[i].threadHandle != NULL) 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle(periodicTriggerThread[i].threadHandle);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;if (quitEvent != NULL) 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;{
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle(quitEvent);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> (numPeriodicTasks > 0)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;for (i = 0; i < %<<span>numPeriodicTasks</span>>; i++)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;{
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (periodicThread[i].startEvent != NULL) 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle(periodicThread[i].startEvent);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (periodicThread[i].stopEvent != NULL) 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle(periodicThread[i].stopEvent);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (periodicThread[i].threadHandle != NULL) 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle(periodicThread[i].threadHandle);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> (numAperiodicTasks > 0)  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;for (i = 0; i < %<<span>numAperiodicTasks</span>>; i++)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;{
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (aperiodicThread[i].startEvent != NULL) 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle(aperiodicThread[i].startEvent);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (aperiodicThread[i].threadHandle != NULL) 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle(aperiodicThread[i].threadHandle);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;printf("**stopping the model**/n");
 <br>&nbsp;&nbsp;&nbsp;&nbsp;fflush(stdout);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> !SuppressErrorStatus
 <br>&nbsp;&nbsp;&nbsp;&nbsp;if (%<<span><a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/rtmdllib_obs.html#RTMGetErrStat">RTMGetErrStat</a>()</span>> != NULL)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;{
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fprintf(stderr, "/n**%s**/n", %<<span><a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/rtmdllib_obs.html#RTMGetErrStat">RTMGetErrStat</a>()</span>>);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;MdlTerminate();
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#SLibIsTaskProfilingOn">SLibIsTaskProfilingOn</a>()
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;writeProfileDataToHTMLFile();
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;return 0;
 <br>&nbsp;&nbsp;}
 <br>&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;<span class="tlc_closefile">%closefile</span> tmpFcnBuf
 <br>&nbsp;&nbsp;%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/filepackaginglib.html#SLibCacheCodeToFile">SLibCacheCodeToFile</a>("mainSrc_fcn_defn", tmpFcnBuf)>
 <br><span class="tlc_fkw">%endfunction</span>
 <br>&nbsp; <br><span class="tlc_comment">%%
</span> <br><span class="tlc_comment">%%**********************************************************************
</span> <br><span class="tlc_comment">%%<span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span><span style="padding-left:9.5px"></span>This<span style="padding-left:9.5px"></span>is<span style="padding-left:9.5px"></span>the<span style="padding-left:9.5px"></span>entry<span style="padding-left:9.5px"></span>point<span style="padding-left:9.5px"></span>for<span style="padding-left:9.5px"></span>generating<span style="padding-left:9.5px"></span>main.c<span style="padding-left:9.5px"></span>
</span> <br><span class="tlc_comment">%%**********************************************************************
</span> <br><span class="tlc_fkw">%function</span> <a id="SLibGenerateThreadedMain" class="tlc_func">SLibGenerateThreadedMain</a>() <span class="tlc_fkw">void</span>
 <br>&nbsp;&nbsp;<span class="tlc_assign">%assign</span> numPeriodicTasks  = <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#SLibGetNumPeriodicTasks">SLibGetNumPeriodicTasks</a>()
 <br>&nbsp;&nbsp;<span class="tlc_assign">%assign</span> numAperiodicTasks = <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#SLibGetNumAperiodicTasks">SLibGetNumAperiodicTasks</a>()   
 <br>&nbsp;&nbsp;<span class="tlc_comment">%% Event handler mapping on Windows uses threads waiting for the event</span>
 <br>&nbsp;&nbsp;<span class="tlc_foreach">%foreach</span> aehIdx = <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibGetNumTriggers">LibGetNumTriggers</a>()
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> evType = <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibGetTriggerType">LibGetTriggerType</a>(aehIdx)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> <span class="tlc_bifunc">ISEQUAL</span>(evType, "PeriodicTrigger")
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_continue">%continue</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> type = <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#LibGetTriggerHandlerType">LibGetTriggerHandlerType</a>(aehIdx) 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> <span class="tlc_bifunc">ISEQUAL</span>(type, "isr")
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> numAperiodicTasks = numAperiodicTasks + 1
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;<span class="tlc_endforeach">%endforeach</span>
 <br>&nbsp;&nbsp;<span class="tlc_assign">%assign</span> numPeriodicTriggers = <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#SLibGetNumPeriodicTriggers">SLibGetNumPeriodicTriggers</a>()
 <br>&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;<span class="tlc_openfile">%openfile</span> tmpFcnBuf
 <br>&nbsp;&nbsp;/*
 <br>&nbsp;&nbsp;* Code generation for Simulink model "%<<span><a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/ertmainlib.html#FcnMdlName">FcnMdlName</a>()</span>>"
 <br>&nbsp;&nbsp;*
 <br>&nbsp;&nbsp;* File version               : %<<span>Version</span>>
 <br>&nbsp;&nbsp;* File generated on          : %<<span>GeneratedOn</span>>
 <br>&nbsp;&nbsp;* C source code generated on : %<<span>TLC_TIME</span>>
 <br>&nbsp;&nbsp;*
 <br>&nbsp;&nbsp;* Compiler specified defines:
 <br>&nbsp;&nbsp;*   RT
 <br>&nbsp;&nbsp;*   MODEL           = %<::CompiledModel.Name>
 <br>&nbsp;&nbsp;*   NUMST           = %<::CompiledModel.NumSampleTimes> (Number of sample times)
 <br>&nbsp;&nbsp;*   NCSTATES        = %<::CompiledModel.NumContStates> (Number of continuous states)
 <br>&nbsp;&nbsp;*   TID01EQ         = %<::CompiledModel.FixedStepOpts.TID01EQ> 
 <br>&nbsp;&nbsp;*                     (Set to 1 if sample time task id's 0 and 1 have equal rates)
 <br>&nbsp;&nbsp;*
 <br>&nbsp;&nbsp;* For more information:
 <br>&nbsp;&nbsp;*   o Simulink Coder User's Guide
 <br>&nbsp;&nbsp;*/     
 <br>&nbsp;&nbsp;<span class="tlc_closefile">%closefile</span> tmpFcnBuf
 <br>&nbsp;&nbsp;%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/filepackaginglib.html#SLibCacheCodeToFile">SLibCacheCodeToFile</a>("mainSrc_ban", tmpFcnBuf)>
 <br>&nbsp; <br>&nbsp;&nbsp;<span class="tlc_openfile">%openfile</span> tmpFcnBuf
 <br>&nbsp;&nbsp;#ifndef _WIN32
 <br>&nbsp;&nbsp;#define _WIN32
 <br>&nbsp;&nbsp;#endif
 <br>&nbsp;&nbsp;#ifndef _WIN32_WINNT
 <br>&nbsp;&nbsp;#define _WIN32_WINNT 0x0500
 <br>&nbsp;&nbsp;#endif
 <br>&nbsp;&nbsp;#include <windows.h>
 <br>&nbsp;&nbsp;#include <process.h>  
 <br>&nbsp;&nbsp;<span class="tlc_if">%if</span> !<a href="https://foool.github.io/r2020a/rtw/c/tlc/lib/utillib.html#SLibIsERTTarget">SLibIsERTTarget</a>()
 <br>&nbsp;&nbsp;&nbsp;&nbsp;#include "rtmodel.h"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> ::GenerateGRTWrapper
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#include "rt_sim.h" 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;<span class="tlc_endif">%endif</span>  
 <br>&nbsp;&nbsp;#include <stdlib.h>
 <br>&nbsp;&nbsp;<span class="tlc_if">%if</span> <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/commonthreadlib.html#SLibIsTaskProfilingOn">SLibIsTaskProfilingOn</a>()
 <br>&nbsp;&nbsp;&nbsp;&nbsp;#include <time.h>
 <br>&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;<span class="tlc_closefile">%closefile</span> tmpFcnBuf
 <br>&nbsp;&nbsp;%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/filepackaginglib.html#SLibCacheCodeToFile">SLibCacheCodeToFile</a>("mainSrc_incl", tmpFcnBuf)>
 <br>&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;<span class="tlc_openfile">%openfile</span> tmpFcnBuf 
 <br>&nbsp;&nbsp;<span class="tlc_if">%if</span> ::GenerateGRTWrapper
 <br>&nbsp;&nbsp;&nbsp;&nbsp;%<<span><a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/ertmain_grtinterface.html#FcnGenerateCommonCodeForGRTWrapper">FcnGenerateCommonCodeForGRTWrapper</a>()</span>>
 <br>&nbsp;&nbsp;<span class="tlc_else">%else</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;%<<span><a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/ertmain_grtinterface.html#FcnGenerateCommonCodeForGRTSimplified">FcnGenerateCommonCodeForGRTSimplified</a>()</span>>
 <br>&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;<span class="tlc_if">%if</span> ::UsingMalloc
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%<::tSimStructType> *%<::tSimStruct>;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const char *RT_MEMORY_ALLOCATION_ERROR = "memory allocation error"; 
 <br>&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;<span class="tlc_comment">%%SLibDeclareModelFcnArgs is already called in <a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/ertmain_grtinterface.html">ertmain_grtinterface.tlc</a></span>
 <br>&nbsp;&nbsp;<span class="tlc_comment">%%Check for reusable code to avoid duplicate definition</span>
 <br>&nbsp;&nbsp;<span class="tlc_if">%if</span> !(::MultiInstanceERTCode &amp;&amp; !::GenerateClassInterface)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/ertmodelarg.html#SLibDeclareModelFcnArgs">SLibDeclareModelFcnArgs</a>(TLC_TRUE)>/
 <br>&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;%<<span><a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/ertmodelarg.html#SLibDeclareFcnProtoCtlGlobalVariables">SLibDeclareFcnProtoCtlGlobalVariables</a>()</span>>
 <br>&nbsp;&nbsp;%<<span><a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/ertmodelarg.html#SLibDeclareGlobalVariablesForCPPClass">SLibDeclareGlobalVariablesForCPPClass</a>()</span>>
 <br>&nbsp;&nbsp;<span class="tlc_closefile">%closefile</span> tmpFcnBuf
 <br>&nbsp;&nbsp;%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/filepackaginglib.html#SLibCacheCodeToFile">SLibCacheCodeToFile</a>("mainSrc_data_defn", tmpFcnBuf)>
 <br>&nbsp;&nbsp; <br>&nbsp;&nbsp;%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/ertposixthread.html#FcnGenerateUtilFunctionsAndGlobalVariables">FcnGenerateUtilFunctionsAndGlobalVariables</a>(numPeriodicTasks, numAperiodicTasks, ...
 <br>&nbsp;&nbsp;&nbsp;&nbsp;numPeriodicTriggers)>
 <br>&nbsp;&nbsp;%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/ertposixthread.html#FcnGeneratePeriodicTaskWrapperFunctions">FcnGeneratePeriodicTaskWrapperFunctions</a>(numPeriodicTasks, numPeriodicTriggers)>
 <br>&nbsp;&nbsp;%<<span><a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/ertposixthread.html#FcnGenerateAperiodicWrapperFunctions">FcnGenerateAperiodicWrapperFunctions</a>()</span>>
 <br>&nbsp;&nbsp;%<<a href="https://foool.github.io/r2020a/rtw/c/tlc/mw/ertposixthread.html#FcnGenerateMainFunction">FcnGenerateMainFunction</a>(numPeriodicTasks, numAperiodicTasks, numPeriodicTriggers)> 
 <br><span class="tlc_fkw">%endfunction</span>
 <br></body></html>