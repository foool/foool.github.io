<html>
<head>

<style>
p {color : black; font-family:courier; font-size: 80%;}
body {line-height: 100%; font-family:courier;}
.tlc_func {color : blue; font-weight: bold; font-size:120%;}
.tlc_if {color: green;}.tlc_assign {color: green;}.tlc_each {color: green;}.tlc_foreach {color: green;}.tlc_endif {color: green;}.tlc_switch {color: green;}.tlc_case {color: green;}.tlc_return {color: green;}.tlc_elseif {color: green;}.tlc_else {color: green;}.tlc_assert {color: green;}.tlc_function {color: green;}.tlc_endfunction {color: green;}.tlc_generatefile {color: green;}.tlc_includepath {color: green;}.tlc_include {color: green;}.tlc_sprintf {color: green;}.tlc_while {color: green;}.tlc_endwhile {color: green;}.tlc_default {color: green;}.tlc_createrecord {color: green;}.tlc_mergerecord {color: green;}.tlc_language {color: green;}.tlc_roll {color: green;}.tlc_endroll {color: green;}.tlc_with {color: green;}
.tlc_bifunc {color: brown;}
</style>

</head>
<body>
%% File: <a href="https://foool.github.io/MATLAB/R2020a/toolbox/rtw/targets/common/profile/memory/profilegen.html">profilegen.tlc</a>
 <br>%%
 <br>%% 
 <br>%% 
 <br>%%
 <br>%% Abstract:
 <br>%%   This is the tlc file used to generate MATLAB file which 
 <br>%%   will generate HTML profile report later.
 <br>%%
 <br>&nbsp; <br>%% Usage:
 <br>%%   To use this tool, user needs follow steps:
 <br>%%   1. Create CompiledModel.Settings and CompiledModel.PathInfo record which defines following parameters:
 <br>%%      CompiledModel.Settings.TargetCompiler
 <br>%%        - Name for cross compiler for target processor. It will decide rule file name. 
 <br>%%          It can be overriden by function parameter.
 <br>%%      CompiledModel.Settings.
 <br>%%      CompiledModel.PathInfo.MODEL_ABS_PATH
 <br>%%        - absolute path for model, i.e., D:/MATLAB6P5/Work/model_mpc555pil
 <br>%%      CompiledModel.PathInfo.PATH_SEP
 <br>%%        - path seperator, on PC it's normal "/", and "/" on UNIX
 <br>%%      CompiledModel.PathInfo.PROFILE_DIR
 <br>%%        - Path for profile tool directory, i.e., matlabroot/toolbox/rtw/targets/common/profile/1.0
 <br>%%      CompiledModel.PathInfo.MATLABROOT
 <br>%%        - root for MATLAB
 <br>%%      CompiledModel.PathInfo.
 <br>%%   2. In main TLC process flow, include <a href="https://foool.github.io/MATLAB/R2020a/toolbox/rtw/targets/common/profile/memory/profilegen.html">profilegen.tlc</a>. We recommend put the 
 <br>%%      include statement inside <target>_genfiles.tlc for clarity. If you include
 <br>%%      it in the System Target File, please make sure do it after "<a href="https://foool.github.io/MATLAB/R2020a/rtw/c/tlc/public_api/codegenentry.html">codegenentry.tlc</a>"
 <br>%%      as it needs info for generated module code.
 <br>%%
 <br>%%   3. Place the "htmlreport.m" callback in <target>_make_rtw_hook.m, 
 <br>%%      within 'exit' case, i.e.,
 <br>%%        switch method
 <br>%%        ... 
 <br>%%        case 'exit':
 <br>%%        if (buildOpts.generateCodeOnly == 0)
 <br>%%          ...
 <br>%%          htmlreport;
 <br>%%          ...
 <br>%%        end
 <br>%%        ...
 <br>&nbsp; <br>%% Output files:
 <br>%%   <build_dir>/htmlreport.m 
 <br>%%      - the generated MATLAB file (located in build the directory), which 
 <br>%%        executes the report generation action.
 <br>%%   <build_dir>/html/profile.html
 <br>%%      - the final code profiling report linked with normal HTML report
 <br>&nbsp; <br>%% Intermediate files:
 <br>%%   During the profile report generation stage, following files will be 
 <br>%%   generated for internal usage.
 <br>%%   <build_dir>/<ModelName>_gen_file_list.txt
 <br>%%      - it's a text file lists all files generated by Simulink.
 <br>%%   <build_dir>/<ModelName>.csv
 <br>%%      - it's a comma seperated file store intermediate parse result.
 <br>&nbsp; <br>&nbsp; <br>%% Copyright 2002-2013 The MathWorks, Inc.
 <br>%%
 <br><span class="tlc_selectfile">%selectfile</span> NULL_FILE
 <br>&nbsp; <br>%% Function: LibGenCodeProfileReport ===========================================
 <br>%% Abstract:
 <br>%%   the main entry function to be called by user
 <br>%% Parameter:
 <br>%%   rtwlib_filelist_file
 <br>%%     - A text file which contains rtwlib library name, i.e., rtwlib.PPCEABI.H.a, 
 <br>%%       rtwlib.a, rtwlib.lib, etc. See toolbox/rtw/targets/common/profile/1.0/rtwlib.txt
 <br>%%       for example.
 <br>%%       User can provide empty string "" for this parameter, in this case, profile 
 <br>%%       tool will use default rtwlib.txt as input.
 <br>%%   target_compiler
 <br>%%     - name of target compiler. i.e., "CodeWarrior" or "Diab". This parameter is used to
 <br>%%       to decide rule file name.
 <br>%%       User can provide empty string "" for this parameter, in this case, 
 <br>%%       CompiledModel.Settings.TargetCompiler will be used to determine compiler.
 <br>%%   exec_file
 <br>%%     - name of executable building result. It's needed to validate build by checking time flag.
 <br>%%       User can provide empty string "" for this parameter, in this case, 
 <br>%%       <model>*.elf will be the default name for CodeWarrior compiler,
 <br>%%       <model>*.out for Diab compiler.
 <br>%%   map_file
 <br>%%     - name of map file generated for this model. 
 <br>%%       User can provide empty string "" for this parameter, in this case, 
 <br>%%       <model>.map will be the default name.
 <br>%%   html_format
 <br>%%     - choose the format for HTML report. Current support 2 formats: "export" and "normal"
 <br>%%       "export" is for algorithm export target, refer to exp_html.rul.
 <br>%%       "normal" refers to html.rul.
 <br>%%       User can provide empty string "" for this parameter, in this case, 
 <br>%%       "normal" will be the default value.
 <br><span class="tlc_function">%function</span> <a id="LibGenCodeProfileReport" class="tlc_func">LibGenCodeProfileReport</a>(rtwlib_filelist_file, target_compiler, exec_file, map_file, html_format) void
 <br>&nbsp;&nbsp;<span class="tlc_with">%with</span> CompiledModel.PathInfo
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> ModelName = CompiledModel.Name
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> <span class="tlc_bifunc">ISEMPTY</span>(rtwlib_filelist_file)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> rtwlib_filelist_file = "%&lt;PROFILE_DIR&gt;%&lt;PATH_SEP&gt;rtwlib.txt"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> <span class="tlc_bifunc">ISEMPTY</span>(target_compiler)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> <span class="tlc_bifunc">ISFIELD</span>(CompiledModel, "Settings")
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> target_compiler = CompiledModel.Settings.TargetCompiler
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_else">%else</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_exit">%exit</span> Code generation error: please specify correct target compiler.
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> <span class="tlc_bifunc">ISEMPTY</span>(exec_file)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> target_compiler == "CodeWarrior"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> exec_file = "%&lt;MODEL_ABS_PATH&gt;%&lt;PATH_SEP&gt;..%&lt;PATH_SEP&gt;%&lt;ModelName&gt;*.elf"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_elseif">%elseif</span>  target_compiler == "Diab"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> exec_file = "%&lt;MODEL_ABS_PATH&gt;%&lt;PATH_SEP&gt;..%&lt;PATH_SEP&gt;%&lt;ModelName&gt;*.out"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_elseif">%elseif</span>  target_compiler == "Tasking"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> exec_file = "%&lt;MODEL_ABS_PATH&gt;%&lt;PATH_SEP&gt;..%&lt;PATH_SEP&gt;%&lt;ModelName&gt;*.abs"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_else">%else</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_exit">%exit</span> Code generation error: please specify correct target compiler.
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> <span class="tlc_bifunc">ISEMPTY</span>(map_file)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> map_file = "%&lt;MODEL_ABS_PATH&gt;%&lt;PATH_SEP&gt;..%&lt;PATH_SEP&gt;%&lt;ModelName&gt;.map"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> <span class="tlc_bifunc">ISEMPTY</span>(html_format)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> html_format = "normal"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> model_gen_file_list = "%&lt;MODEL_ABS_PATH&gt;%&lt;PATH_SEP&gt;%&lt;ModelName&gt;_gen_file_list.txt"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;%&lt;<a href="https://foool.github.io/MATLAB/R2020a/toolbox/rtw/targets/common/profile/memory/profilegen.html#CreateMdlGenFileList">CreateMdlGenFileList</a>(model_gen_file_list)&gt;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> gen_mfile_name = "htmlreport.m"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> PERL = "%&lt;MATLABROOT&gt;%&lt;PATH_SEP&gt;sys%&lt;PATH_SEP&gt;perl%&lt;PATH_SEP&gt;win32%&lt;PATH_SEP&gt;bin%&lt;PATH_SEP&gt;perl"
 <br>&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;%% The core support files exist in the toolbox/rtw/targets/common/profile/memory directory.
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> commondir = "%&lt;MATLABROOT&gt;%&lt;PATH_SEP&gt;toolbox%&lt;PATH_SEP&gt;rtw%&lt;PATH_SEP&gt;targets%&lt;PATH_SEP&gt;common%&lt;PATH_SEP&gt;profile%&lt;PATH_SEP&gt;memory"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> MAP2IR = "%&lt;commondir&gt;%&lt;PATH_SEP&gt;map2ir.pl"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> IR2HTML = "%&lt;commondir&gt;%&lt;PATH_SEP&gt;ir2html.pl"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> HOOKUP_HTML = "%&lt;commondir&gt;%&lt;PATH_SEP&gt;hookup.pl"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> target_compiler == "CodeWarrior"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> RULE_FILE = "%&lt;PROFILE_DIR&gt;%&lt;PATH_SEP&gt;cw.rul"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_elseif">%elseif</span>  target_compiler == "Diab"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> RULE_FILE = "%&lt;PROFILE_DIR&gt;%&lt;PATH_SEP&gt;diab.rul"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_elseif">%elseif</span>  target_compiler == "Tasking" || target_compiler == "tasking"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> RULE_FILE = "%&lt;PROFILE_DIR&gt;%&lt;PATH_SEP&gt;tasking.rul"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_elseif">%elseif</span>  target_compiler == "GNU"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> RULE_FILE = "%&lt;PROFILE_DIR&gt;%&lt;PATH_SEP&gt;gnu.rul"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_else">%else</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%% Assume full path to compiler rule file has been given
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> RULE_FILE = target_compiler
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>  
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> IR_FILE = "%&lt;MODEL_ABS_PATH&gt;%&lt;PATH_SEP&gt;%&lt;ModelName&gt;.csv"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> html_format == "export"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> HTML_RULE_FILE = "%&lt;PROFILE_DIR&gt;%&lt;PATH_SEP&gt;exp_html.rul"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_elseif">%elseif</span> html_format == "normal"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> HTML_RULE_FILE = "%&lt;PROFILE_DIR&gt;%&lt;PATH_SEP&gt;html.rul"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_else">%else</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%% Assume full path to html rule file has been given
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> HTML_RULE_FILE = html_format
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;%% we need PATH_SEP so we could pass it directly to IR2HTML perl script;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> HTML_REPORT_DIR = "%&lt;MODEL_ABS_PATH&gt;%&lt;PATH_SEP&gt;html%&lt;PATH_SEP&gt;"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> PROFILE_REPORT_FILE = "%&lt;HTML_REPORT_DIR&gt;profile.html"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> noPATH_PROFILE_REPORT_FILE = "profile.html"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> HTML_REPORT_CONTENTS =  "%&lt;HTML_REPORT_DIR&gt;%&lt;ModelName&gt;_contents.html"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> HTML_REPORT_FRAME = "%&lt;MODEL_ABS_PATH&gt;%&lt;PATH_SEP&gt;html%&lt;PATH_SEP&gt;%&lt;ModelName&gt;_codegen_rpt.html"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;%<<a href="https://foool.github.io/MATLAB/R2020a/toolbox/rtw/targets/common/profile/memory/profilegen.html#CreateHTMLreportMFile">CreateHTMLreportMFile</a>(gen_mfile_name, map_file, exec_file, ModelName, PERL, MAP2IR, RULE_FILE, IR_FILE, model_gen_file_list, rtwlib_filelist_file, IR2HTML, HTML_RULE_FILE, PROFILE_REPORT_FILE, HTML_REPORT_DIR, PATH_SEP, HOOKUP_HTML, HTML_REPORT_CONTENTS, noPATH_PROFILE_REPORT_FILE, HTML_REPORT_FRAME)>
 <br>&nbsp;&nbsp;<span class="tlc_endwith">%endwith</span>
 <br><span class="tlc_endfunction">%endfunction</span>
 <br>&nbsp; <br>%% internal function to create model generated file list file
 <br><span class="tlc_function">%function</span> <a id="CreateMdlGenFileList" class="tlc_func">CreateMdlGenFileList</a>(model_gen_file_list) void
 <br>&nbsp;&nbsp;<span class="tlc_openfile">%openfile</span> buffer = "%&lt;model_gen_file_list&gt;"
 <br>&nbsp;&nbsp;<span class="tlc_if">%if</span> <span class="tlc_bifunc">ISFIELD</span>(CompiledModel,"ModelFiles")
 <br>&nbsp;&nbsp;<span class="tlc_with">%with</span> CompiledModel
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_with">%with</span> ModelFiles
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_foreach">%foreach</span> fileIdx = <a href="https://foool.github.io/MATLAB/R2020a/rtw/c/tlc/mw/codetemplatelib.html#LibGetNumModelFiles">LibGetNumModelFiles</a>()
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> fileName  = <a href="https://foool.github.io/MATLAB/R2020a/rtw/c/tlc/mw/codetemplatelib.html#LibGetModelFileAttribute">LibGetModelFileAttribute</a>(fileIdx,"Name")
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> fileSrc   = <a href="https://foool.github.io/MATLAB/R2020a/rtw/c/tlc/mw/codetemplatelib.html#LibGetModelFileAttribute">LibGetModelFileAttribute</a>(fileIdx,"Creator")
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> fileType  = <a href="https://foool.github.io/MATLAB/R2020a/rtw/c/tlc/mw/codetemplatelib.html#LibGetModelFileAttribute">LibGetModelFileAttribute</a>(fileIdx,"Type")
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> opFile    = ModelFile[fileIdx]
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> fileType == "SystemBody"
 <br>&nbsp;&nbsp;&nbsp;%&lt;opFile.Name&gt;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endforeach">%endforeach</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endwith">%endwith</span>
 <br>&nbsp;&nbsp;<span class="tlc_endwith">%endwith</span>
 <br>&nbsp;&nbsp;<span class="tlc_else">%else</span>
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_foreach">%foreach</span> fileIdx = ::CompiledModel.NumSources
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> mdlSrc  = ::CompiledModel.Sources[fileIdx]
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%&lt;mdlSrc&gt;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endforeach">%endforeach</span>
 <br>&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp;&nbsp;<span class="tlc_closefile">%closefile</span> buffer
 <br><span class="tlc_endfunction">%endfunction</span>
 <br>&nbsp; <br>%% internal function to create htmlreport.m 
 <br><span class="tlc_function">%function</span> <a id="CreateHTMLreportMFile" class="tlc_func">CreateHTMLreportMFile</a>(gen_mfile_name, MAP_FILE, ELF_FILE, ModelName, PERL, MAP2IR, RULE_FILE, IR_FILE, model_gen_file_list, rtwlib_filelist_file, IR2HTML, HTML_RULE_FILE, PROFILE_REPORT_FILE, HTML_REPORT_DIR, PATH_SEP, HOOKUP_HTML, HTML_REPORT_CONTENTS, noPATH_PROFILE_REPORT_FILE, HTML_REPORT_FRAME) void
 <br>&nbsp;&nbsp;<span class="tlc_openfile">%openfile</span> buffer = "%&lt;gen_mfile_name&gt;"
 <br>&nbsp;&nbsp;function htmlreport
 <br>&nbsp;&nbsp;<span class="tlc_if">%if</span> "%&lt;GenerateReport&gt;" == "1"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OldFiles=[];
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%% Check timeflag of MAP file to determine whether model been successfully built
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if cmpTimeFlag('%&lt;gen_mfile_name&gt;', '%&lt;MAP_FILE&gt;') <= 0
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OldFiles=[OldFiles ' %&lt;MAP_FILE&gt;'];
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%% Check timeflag of elf file to determine whether model been successfully built
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if cmpTimeFlag('%&lt;gen_mfile_name&gt;', '%&lt;ELF_FILE&gt;') <= 0
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OldFiles=[OldFiles ' %&lt;ELF_FILE&gt;'];
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ~isempty(OldFiles)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error(['### Detected target build failure. Map and/or program file(s) are not up-to-date.'])
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fprintf('### Generating code profile report for model: %s/n', '%&lt;ModelName&gt;');
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_assign">%assign</span> target_compiler = CompiledModel.Settings.TargetCompiler
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_if">%if</span> target_compiler != "Tasking"
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[status,result] = system('"%&lt;PERL&gt;" "%&lt;MAP2IR&gt;" "%&lt;MAP_FILE&gt;" "%&lt;RULE_FILE&gt;" "%&lt;IR_FILE&gt;" "%&lt;model_gen_file_list&gt;" "%&lt;rtwlib_filelist_file&gt;"');
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_else">%else</span> 
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[status,result] = system('"%&lt;PERL&gt;" "%&lt;MAP2IR&gt;" "%&lt;MAP_FILE&gt;" "%&lt;RULE_FILE&gt;" "%&lt;IR_FILE&gt;"');
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tlc_endif">%endif</span>	
 <br>&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[status,result] = system('"%&lt;PERL&gt;" "%&lt;IR2HTML&gt;" "%&lt;IR_FILE&gt;" "%&lt;HTML_RULE_FILE&gt;" "%&lt;PROFILE_REPORT_FILE&gt;" "%&lt;HTML_REPORT_DIR&gt;%&lt;PATH_SEP&gt;"');
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%% need double / here to prevent pass in "
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[status,result] = system('"%&lt;PERL&gt;" "%&lt;HOOKUP_HTML&gt;" "%&lt;HTML_REPORT_CONTENTS&gt;" "%&lt;noPATH_PROFILE_REPORT_FILE&gt;"');
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;drawnow;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;coder.internal.showHtml('%&lt;HTML_REPORT_FRAME&gt;', 'UseWebBrowserWidget');
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fprintf('### Generated code profile report for model: %s/n', '%&lt;ModelName&gt;');
 <br>&nbsp;&nbsp;<span class="tlc_endif">%endif</span>
 <br>&nbsp; <br>&nbsp;&nbsp;function result = cmpTimeFlag(file1, file2)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;%% CMPTIMEFLAG Compare time/date flag of the two input files
 <br>&nbsp;&nbsp;&nbsp;&nbsp;%% CMPTIMEFLAG(file1, file2) return 1  if file1 is earlier than file2
 <br>&nbsp;&nbsp;&nbsp;&nbsp;%%			      return 0  if same time or any file doesn't exist
 <br>&nbsp;&nbsp;&nbsp;&nbsp;%%			      return -1 if file1 is later than file2
 <br>&nbsp;&nbsp;&nbsp;&nbsp;%%   file2 can be wildcard, it will return -1 unless every file2 ealier than file1
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;record1 = dir(eval('file1'));
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[row col] = size(record1);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (row == 0) | (col == 0)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result = 0;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;record2 = dir(eval('file2'));
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[row col] = size(record2);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (row == 0) | (col == 0)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result = 0;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end    
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;date1 = datevec(record1.date);
 <br>&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match_file_num = row;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for loop = 1:match_file_num
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;date2 = datevec(record2(loop).date);
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for i = 1:6
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if date1(i) < date2(i)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result = 1;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elseif date1(i) > date2(i)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result = -1;
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (loop == match_file_num)
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end
 <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result = 0;
 <br>&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;<span class="tlc_closefile">%closefile</span> buffer
 <br><span class="tlc_endfunction">%endfunction</span>
 <br></body></html>